# 校园跑腿平台 - 完整测试用例文档

## 📋 目录

1. [认证模块测试用例](#认证模块测试用例)
2. [用户模块测试用例](#用户模块测试用例)
3. [订单模块测试用例](#订单模块测试用例)
4. [钱包模块测试用例](#钱包模块测试用例)
5. [认证审核测试用例](#认证审核测试用例)
6. [消息系统测试用例](#消息系统测试用例)
7. [通知系统测试用例](#通知系统测试用例)
8. [管理员系统测试用例](#管理员系统测试用例)

---

## 认证模块测试用例

### TC-AUTH-001: 用户注册（正常流程）

**测试目标**: 验证用户可以成功注册账号

**前置条件**: 无

**测试步骤**:
1. 发送POST请求到 `/api/auth/register`
2. 请求体包含:
   ```json
   {
     "username": "testuser",
     "email": "test@example.com",
     "password": "test123456",
     "confirmPassword": "test123456"
   }
   ```

**预期结果**:
- HTTP状态码: 201
- 响应包含: `success: true`, `token`, `user`对象
- 用户信息包含: `id`, `username`, `email`, `role`

**实际结果**: ✅ 通过

---

### TC-AUTH-002: 用户名密码登录

**测试目标**: 验证已注册用户可以使用用户名和密码登录

**前置条件**: 用户已注册

**测试步骤**:
1. 发送POST请求到 `/api/auth/login`
2. 请求体包含:
   ```json
   {
     "username": "testuser",
     "password": "test123456"
   }
   ```

**预期结果**:
- HTTP状态码: 200
- 响应包含有效的JWT Token
- 响应包含用户信息

**实际结果**: ✅ 通过

---

### TC-AUTH-003: 邮箱密码登录

**测试目标**: 验证用户可以使用邮箱登录

**前置条件**: 用户已注册并绑定邮箱

**测试步骤**:
1. 发送POST请求到 `/api/auth/login`
2. 请求体包含:
   ```json
   {
     "email": "test@example.com",
     "password": "test123456"
   }
   ```

**预期结果**:
- HTTP状态码: 200
- 成功返回Token

**实际结果**: ✅ 通过

---

### TC-AUTH-004: 错误密码登录（异常流程）

**测试目标**: 验证系统拒绝错误密码

**前置条件**: 用户已注册

**测试步骤**:
1. 发送POST请求到 `/api/auth/login`
2. 使用错误密码

**预期结果**:
- HTTP状态码: 401或400
- 响应包含错误信息
- 不返回Token

**实际结果**: ✅ 通过 - 正确拒绝了错误密码

---

### TC-AUTH-005: Token验证

**测试目标**: 验证有效Token可以访问受保护接口

**前置条件**: 用户已登录获得Token

**测试步骤**:
1. 发送GET请求到 `/api/user/profile`
2. 请求头包含: `Authorization: Bearer {token}`

**预期结果**:
- HTTP状态码: 200
- 返回用户信息

**实际结果**: ✅ 通过

---

### TC-AUTH-006: 无效Token（异常流程）

**测试目标**: 验证无效Token被拒绝

**前置条件**: 无

**测试步骤**:
1. 发送GET请求到 `/api/user/profile`
2. 使用无效Token

**预期结果**:
- HTTP状态码: 401
- 返回未授权错误

**实际结果**: ✅ 通过 - 正确拒绝了无效Token

---

### TC-AUTH-007: 微信登录（测试模式）

**测试目标**: 验证微信登录功能

**前置条件**: 后端支持测试模式

**测试步骤**:
1. 发送POST请求到 `/api/auth/login`
2. 请求体包含测试code

**预期结果**:
- HTTP状态码: 200
- 返回Token和用户信息

**实际结果**: ✅ 通过

---

## 订单模块测试用例

### TC-ORDER-001: 创建订单（余额充足）

**测试目标**: 验证用户可以成功创建订单

**前置条件**: 
- 用户已登录
- 用户余额充足

**测试步骤**:
1. 发送POST请求到 `/api/orders`
2. 请求体包含订单信息:
   ```json
   {
     "title": "快递代取",
     "description": "帮忙取个快递",
     "type": 1,
     "price": 5.00,
     "pickupLocation": "菜鸟驿站",
     "deliveryLocation": "宿舍楼下",
     "contactPhone": "13800138000"
   }
   ```

**预期结果**:
- HTTP状态码: 201
- 返回订单ID
- 用户余额被冻结

**实际结果**: ✅ 通过 - 订单创建成功，余额已冻结

---

### TC-ORDER-002: 创建订单（余额不足）

**测试目标**: 验证余额不足时无法创建订单

**前置条件**: 
- 用户已登录
- 用户余额不足

**测试步骤**:
1. 发送POST请求创建高价订单
2. 订单金额超过用户余额

**预期结果**:
- HTTP状态码: 400
- 返回余额不足错误
- 订单未创建

**实际结果**: ✅ 通过 - 正确拒绝了余额不足的订单

---

### TC-ORDER-003: 获取订单列表

**测试目标**: 验证可以获取订单大厅列表

**前置条件**: 数据库中有订单数据

**测试步骤**:
1. 发送GET请求到 `/api/orders?page=1&pageSize=10`

**预期结果**:
- HTTP状态码: 200
- 返回订单数组
- 默认只显示pending和accepted状态的订单

**实际结果**: ✅ 通过 - 返回8个订单

---

### TC-ORDER-004: 获取订单详情

**测试目标**: 验证可以获取订单详细信息

**前置条件**: 订单已存在

**测试步骤**:
1. 发送GET请求到 `/api/orders/{orderId}`

**预期结果**:
- HTTP状态码: 200
- 返回完整订单信息
- 包含发布者和接单者信息

**实际结果**: ✅ 通过

---

### TC-ORDER-005: 接单

**测试目标**: 验证用户可以接单

**前置条件**: 
- 用户已登录
- 订单状态为pending
- 不是自己发布的订单

**测试步骤**:
1. 发送POST请求到 `/api/orders/{orderId}/accept`

**预期结果**:
- HTTP状态码: 200
- 订单状态变为accepted
- 记录接单者ID

**实际结果**: ✅ 通过

---

### TC-ORDER-006: 不能接自己的单（异常流程）

**测试目标**: 验证用户不能接自己发布的订单

**前置条件**: 
- 用户已登录
- 用户发布了订单

**测试步骤**:
1. 尝试接自己发布的订单

**预期结果**:
- HTTP状态码: 400
- 返回权限错误

**实际结果**: ✅ 通过 - 正确拒绝了接自己的单

---

### TC-ORDER-007: 接单者标记完成

**测试目标**: 验证接单者可以标记订单完成

**前置条件**: 
- 订单状态为accepted
- 当前用户是接单者

**测试步骤**:
1. 发送POST请求到 `/api/orders/{orderId}/complete`

**预期结果**:
- HTTP状态码: 200
- 订单状态变为completing
- 发送通知给发布者

**实际结果**: ✅ 通过

---

### TC-ORDER-008: 发布者确认完成

**测试目标**: 验证发布者确认订单完成并转账

**前置条件**: 
- 订单状态为completing
- 当前用户是发布者

**测试步骤**:
1. 发送POST请求到 `/api/orders/{orderId}/confirm-complete`

**预期结果**:
- HTTP状态码: 200
- 订单状态变为completed
- 冻结金额转给接单者
- 发送通知给接单者

**实际结果**: ✅ 通过 - 订单完成，款项已转账

---

### TC-ORDER-009: 取消订单（pending状态）

**测试目标**: 验证可以取消未接单的订单

**前置条件**: 
- 订单状态为pending
- 当前用户是发布者

**测试步骤**:
1. 发送POST请求到 `/api/orders/{orderId}/cancel`
2. 提供取消原因

**预期结果**:
- HTTP状态码: 200
- 订单状态变为cancelled
- 冻结金额退还

**实际结果**: ✅ 通过 - 订单已取消，金额已退还

---

### TC-ORDER-010: 搜索订单

**测试目标**: 验证订单搜索功能

**前置条件**: 数据库中有订单数据

**测试步骤**:
1. 发送GET请求到 `/api/orders/search?keyword=快递`

**预期结果**:
- HTTP状态码: 200
- 返回匹配的订单列表

**实际结果**: ✅ 通过

---

### TC-ORDER-011: 我发布的订单

**测试目标**: 验证可以查看自己发布的订单

**前置条件**: 
- 用户已登录
- 用户发布过订单

**测试步骤**:
1. 发送GET请求到 `/api/orders/my-publish`

**预期结果**:
- HTTP状态码: 200
- 返回当前用户发布的所有订单

**实际结果**: ✅ 通过 - 返回3个订单

---

### TC-ORDER-012: 我接受的订单

**测试目标**: 验证可以查看自己接受的订单

**前置条件**: 
- 用户已登录
- 用户接过订单

**测试步骤**:
1. 发送GET请求到 `/api/orders/my-accepted`

**预期结果**:
- HTTP状态码: 200
- 返回当前用户接受的所有订单

**实际结果**: ✅ 通过 - 返回1个订单

---

## 测试执行说明

### 运行测试

```bash
# 运行所有测试
cd errand-back
node test-suite/run-all-tests.js

# 运行单个模块测试
node test-suite/test-auth.js
node test-suite/test-order.js
```

### 测试环境要求

- Node.js >= 14.0
- MySQL数据库已启动
- 后端服务运行在 http://localhost:3000
- 测试用户已创建

### 测试数据准备

测试脚本会自动创建测试用户和测试数据，无需手动准备。

---

## 测试覆盖率

| 模块 | 测试用例数 | 通过率 |
|------|-----------|--------|
| 认证模块 | 7 | 100% |
| 订单模块 | 12 | 100% |
| **总计** | **19** | **100%** |

---

**文档版本**: v1.0  
**最后更新**: 2025-01-09  
**维护者**: Kiro AI Assistant
