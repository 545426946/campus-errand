# æ„è§åé¦ˆå†å²è®°å½•åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

æ„è§åé¦ˆå†å²è®°å½•åŠŸèƒ½å…è®¸ç”¨æˆ·æŸ¥çœ‹è‡ªå·±æäº¤çš„æ‰€æœ‰åé¦ˆè®°å½•ï¼ŒåŒ…æ‹¬åé¦ˆçŠ¶æ€ã€å®˜æ–¹å›å¤ç­‰ä¿¡æ¯ã€‚

## å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯æ¥å£

âœ… **æ•°æ®åº“è¡¨**: `feedbacks` è¡¨å·²åˆ›å»º
- åŒ…å«å­—æ®µï¼šid, user_id, type, title, content, contact, images, status, reply, replied_at, replied_by, created_at, updated_at

âœ… **API æ¥å£**:
- `POST /api/system/feedback` - æäº¤åé¦ˆ
- `GET /api/system/feedback/history` - è·å–åé¦ˆå†å²ï¼ˆéœ€è¦è®¤è¯ï¼‰

âœ… **Model æ–¹æ³•**:
- `Feedback.create()` - åˆ›å»ºåé¦ˆ
- `Feedback.getByUserId()` - è·å–ç”¨æˆ·åé¦ˆåˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- `Feedback.findById()` - è·å–åé¦ˆè¯¦æƒ…
- `Feedback.reply()` - ç®¡ç†å‘˜å›å¤åé¦ˆ

### 2. å‰ç«¯é¡µé¢

âœ… **å†å²è®°å½•é¡µé¢**: `pages/feedback/history`
- history.js - é¡µé¢é€»è¾‘
- history.wxml - é¡µé¢ç»“æ„
- history.wxss - é¡µé¢æ ·å¼
- history.json - é¡µé¢é…ç½®

âœ… **åŠŸèƒ½ç‰¹æ€§**:
- ç»Ÿè®¡å¡ç‰‡ï¼šæ˜¾ç¤ºæ€»è®¡ã€ä»Šå¤©ã€æœ¬å‘¨ã€æœ¬æœˆçš„åé¦ˆæ•°é‡
- ç­›é€‰æ ‡ç­¾ï¼šå…¨éƒ¨ã€ä»Šå¤©ã€æœ¬å‘¨ã€æœ¬æœˆ
- åé¦ˆåˆ—è¡¨ï¼šæ˜¾ç¤ºåé¦ˆç±»å‹ã€çŠ¶æ€ã€æ ‡é¢˜ã€å†…å®¹é¢„è§ˆ
- å›¾ç‰‡é¢„è§ˆï¼šæ”¯æŒæŸ¥çœ‹åé¦ˆä¸­çš„å›¾ç‰‡
- å®˜æ–¹å›å¤ï¼šæ˜¾ç¤ºç®¡ç†å‘˜çš„å›å¤å†…å®¹
- ä¸‹æ‹‰åˆ·æ–°ï¼šæ”¯æŒä¸‹æ‹‰åˆ·æ–°åˆ—è¡¨
- ä¸Šæ‹‰åŠ è½½ï¼šæ”¯æŒåˆ†é¡µåŠ è½½æ›´å¤š
- æ‚¬æµ®æŒ‰é’®ï¼šå¿«é€Ÿè¿”å›åˆ›å»ºåé¦ˆé¡µé¢

âœ… **API é›†æˆ**:
- `common.js` ä¸­æ·»åŠ äº† `getFeedbackHistory()` æ–¹æ³•

âœ… **é¡µé¢æ³¨å†Œ**:
- å·²åœ¨ `app.json` ä¸­æ³¨å†Œå†å²è®°å½•é¡µé¢

### 3. æ ·å¼ä¼˜åŒ–

âœ… **è¾“å…¥æ¡†ä¼˜åŒ–**ï¼ˆfeedback.wxml/wxssï¼‰:
- ç¼©çŸ­æç¤ºè¯ï¼Œç¡®ä¿å®Œæ•´æ˜¾ç¤º
- ä¼˜åŒ–è¾“å…¥æ¡†é«˜åº¦å’Œå†…è¾¹è·
- æ”¹è¿› placeholder æ ·å¼å’Œé¢œè‰²
- æ·»åŠ èšç„¦æ•ˆæœå’Œè¿‡æ¸¡åŠ¨ç”»

## ä½¿ç”¨æ–¹æ³•

### ç”¨æˆ·ç«¯

1. **æäº¤åé¦ˆ**
   - è¿›å…¥"æˆ‘çš„" -> "æ„è§åé¦ˆ"
   - é€‰æ‹©åé¦ˆç±»å‹
   - å¡«å†™æ ‡é¢˜å’Œå†…å®¹
   - å¯é€‰ï¼šæ·»åŠ è”ç³»æ–¹å¼å’Œå›¾ç‰‡
   - ç‚¹å‡»"æäº¤åé¦ˆ"

2. **æŸ¥çœ‹å†å²è®°å½•**
   - åœ¨åé¦ˆé¡µé¢ç‚¹å‡»"æŸ¥çœ‹æˆ‘çš„åé¦ˆè®°å½•"
   - æˆ–ç›´æ¥å¯¼èˆªåˆ° `/pages/feedback/history`
   - æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯å’Œåé¦ˆåˆ—è¡¨
   - ç‚¹å‡»åé¦ˆé¡¹æŸ¥çœ‹è¯¦æƒ…
   - ä¸‹æ‹‰åˆ·æ–°æˆ–ä¸Šæ‹‰åŠ è½½æ›´å¤š

### ç®¡ç†å‘˜ç«¯

ç®¡ç†å‘˜å¯ä»¥åœ¨ç®¡ç†åå°æŸ¥çœ‹å’Œå›å¤ç”¨æˆ·åé¦ˆï¼š
- è®¿é—®ç®¡ç†åå°çš„"åé¦ˆç®¡ç†"æ¨¡å—
- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åé¦ˆ
- å›å¤ç”¨æˆ·åé¦ˆ
- æ›´æ–°åé¦ˆçŠ¶æ€

## æ•°æ®ç»“æ„

### åé¦ˆç±»å‹ (type)
- `bug` - Bugåé¦ˆ ğŸ›
- `feature` - åŠŸèƒ½å»ºè®® ğŸ’¡
- `complaint` - æŠ•è¯‰å»ºè®® âš ï¸
- `other` - å…¶ä»–é—®é¢˜ â“

### åé¦ˆçŠ¶æ€ (status)
- `pending` - å¾…å¤„ç† â³
- `processing` - å¤„ç†ä¸­ ğŸ”„
- `resolved` - å·²è§£å†³ âœ…
- `closed` - å·²å…³é—­ ğŸ”’

## æµ‹è¯•æ­¥éª¤

### 1. åç«¯æµ‹è¯•

```bash
cd errand-back

# åˆ›å»ºæ•°æ®åº“è¡¨
node create-feedbacks-table.js

# æµ‹è¯• API
node test-feedback-api.js
```

### 2. å‰ç«¯æµ‹è¯•

1. å¯åŠ¨åç«¯æœåŠ¡å™¨
```bash
cd errand-back
npm start
```

2. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€å°ç¨‹åºé¡¹ç›®

3. æµ‹è¯•æµç¨‹ï¼š
   - ç™»å½•å°ç¨‹åº
   - è¿›å…¥"æˆ‘çš„" -> "æ„è§åé¦ˆ"
   - æäº¤ä¸€æ¡æµ‹è¯•åé¦ˆ
   - ç‚¹å‡»"æŸ¥çœ‹æˆ‘çš„åé¦ˆè®°å½•"
   - éªŒè¯å†å²è®°å½•æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
   - æµ‹è¯•ä¸‹æ‹‰åˆ·æ–°
   - æµ‹è¯•ä¸Šæ‹‰åŠ è½½æ›´å¤š
   - ç‚¹å‡»åé¦ˆé¡¹æŸ¥çœ‹è¯¦æƒ…

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šå†å²è®°å½•æ˜¾ç¤ºä¸ºç©º

**å¯èƒ½åŸå› **ï¼š
1. ç”¨æˆ·æœªç™»å½•æˆ– token æ— æ•ˆ
2. æ•°æ®åº“ä¸­æ²¡æœ‰è¯¥ç”¨æˆ·çš„åé¦ˆè®°å½•
3. åç«¯æ¥å£è¿”å›é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼š
   ```javascript
   const token = wx.getStorageSync('token');
   console.log('Token:', token);
   ```

2. æ£€æŸ¥åç«¯æ—¥å¿—ï¼ŒæŸ¥çœ‹ API è¯·æ±‚æ˜¯å¦æˆåŠŸ

3. åœ¨æµè§ˆå™¨æ§åˆ¶å°æˆ–å°ç¨‹åºè°ƒè¯•å™¨ä¸­æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

4. æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•æ•°æ®ï¼š
   ```bash
   cd errand-back
   node test-feedback-api.js
   ```

### é—®é¢˜ï¼šå›¾ç‰‡æ— æ³•æ˜¾ç¤º

**å¯èƒ½åŸå› **ï¼š
1. å›¾ç‰‡ URL ä¸æ­£ç¡®
2. å›¾ç‰‡æœåŠ¡å™¨ä¸å¯è®¿é—®
3. å°ç¨‹åºåŸŸåæœªé…ç½®

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥å›¾ç‰‡ URL æ ¼å¼
2. åœ¨å°ç¨‹åºåå°é…ç½®åˆæ³•åŸŸå
3. ä½¿ç”¨ä¸´æ—¶å›¾ç‰‡è¿›è¡Œæµ‹è¯•

## API æ–‡æ¡£

### è·å–åé¦ˆå†å²

**è¯·æ±‚**ï¼š
```
GET /api/system/feedback/history
```

**å‚æ•°**ï¼š
- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤ 1
- `pageSize` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 20

**å“åº”**ï¼š
```json
{
  "success": true,
  "code": 0,
  "data": {
    "list": [
      {
        "id": 1,
        "user_id": 1,
        "type": "bug",
        "title": "åé¦ˆæ ‡é¢˜",
        "content": "åé¦ˆå†…å®¹",
        "contact": "13800138000",
        "images": ["url1", "url2"],
        "status": "pending",
        "reply": null,
        "replied_at": null,
        "replied_by": null,
        "created_at": "2024-01-01T00:00:00.000Z",
        "updated_at": "2024-01-01T00:00:00.000Z"
      }
    ],
    "total": 10
  }
}
```

## åç»­ä¼˜åŒ–å»ºè®®

1. **ç­›é€‰åŠŸèƒ½å¢å¼º**
   - æŒ‰çŠ¶æ€ç­›é€‰ï¼ˆå¾…å¤„ç†ã€å¤„ç†ä¸­ã€å·²è§£å†³ï¼‰
   - æŒ‰ç±»å‹ç­›é€‰ï¼ˆBugã€åŠŸèƒ½å»ºè®®ç­‰ï¼‰
   - æœç´¢åŠŸèƒ½

2. **é€šçŸ¥åŠŸèƒ½**
   - å½“ç®¡ç†å‘˜å›å¤æ—¶ï¼Œå‘é€é€šçŸ¥ç»™ç”¨æˆ·
   - åœ¨æ¶ˆæ¯ä¸­å¿ƒæ˜¾ç¤ºåé¦ˆå›å¤

3. **è¯¦æƒ…é¡µé¢**
   - åˆ›å»ºç‹¬ç«‹çš„åé¦ˆè¯¦æƒ…é¡µé¢
   - æ”¯æŒæŸ¥çœ‹å®Œæ•´çš„å¯¹è¯å†å²
   - æ”¯æŒç”¨æˆ·è¿½åŠ è¯„è®º

4. **æ•°æ®ç»Ÿè®¡**
   - æ˜¾ç¤ºæ›´è¯¦ç»†çš„ç»Ÿè®¡å›¾è¡¨
   - åé¦ˆè¶‹åŠ¿åˆ†æ

## æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
- `errand-back/src/models/Feedback.js` - åé¦ˆæ•°æ®æ¨¡å‹
- `errand-back/src/controllers/system.controller.js` - ç³»ç»Ÿæ§åˆ¶å™¨ï¼ˆåŒ…å«åé¦ˆæ¥å£ï¼‰
- `errand-back/src/routes/system.routes.js` - ç³»ç»Ÿè·¯ç”±
- `errand-back/create-feedbacks-table.js` - åˆ›å»ºæ•°æ®åº“è¡¨è„šæœ¬
- `errand-back/test-feedback-api.js` - API æµ‹è¯•è„šæœ¬

### å‰ç«¯æ–‡ä»¶
- `errand-front/pages/feedback/feedback.js` - åé¦ˆæäº¤é¡µé¢
- `errand-front/pages/feedback/feedback.wxml`
- `errand-front/pages/feedback/feedback.wxss`
- `errand-front/pages/feedback/feedback.json`
- `errand-front/pages/feedback/history.js` - å†å²è®°å½•é¡µé¢
- `errand-front/pages/feedback/history.wxml`
- `errand-front/pages/feedback/history.wxss`
- `errand-front/pages/feedback/history.json`
- `errand-front/api/common.js` - é€šç”¨ APIï¼ˆåŒ…å«åé¦ˆæ¥å£ï¼‰

## æ›´æ–°æ—¥å¿—

### 2024-01-09
- âœ… åˆ›å»ºå†å²è®°å½•é¡µé¢
- âœ… ä¼˜åŒ–åé¦ˆè¾“å…¥æ¡†æ ·å¼å’Œæç¤ºè¯
- âœ… æ·»åŠ ç»Ÿè®¡å¡ç‰‡å’Œç­›é€‰åŠŸèƒ½
- âœ… å®ç°ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½
- âœ… æ·»åŠ å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
- âœ… å®Œå–„ API é›†æˆ
- âœ… åˆ›å»ºæµ‹è¯•è„šæœ¬å’Œæ–‡æ¡£
