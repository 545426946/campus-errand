# 校园跑腿管理员系统使用说明

## 系统概述

管理员系统是一个独立的后台管理平台，用于管理校园跑腿平台的用户、订单和认证审核等功能。

## 功能特性

### 1. 管理员登录
- 使用管理员账号密码登录
- JWT Token 认证机制
- 支持多级权限管理（超级管理员、管理员、审核员）

### 2. 数据统计
- 用户统计（总用户数、已认证用户、今日新增）
- 订单统计（总订单数、待处理、已完成）
- 认证统计（待审核、已通过、已拒绝）

### 3. 用户管理
- 查看所有用户列表
- 搜索用户（用户名、昵称、手机号、学号）
- 筛选认证状态
- 查看用户详情
- 编辑用户信息
- 删除用户（超级管理员权限）

### 4. 订单管理
- 查看所有订单列表
- 搜索订单（标题、描述）
- 筛选订单状态
- 查看订单详情
- 编辑订单信息
- 删除订单（超级管理员权限）

### 5. 认证审核
- 查看所有认证申请
- 筛选认证状态
- 查看认证详情（包括证件照片）
- 审核通过/拒绝认证申请
- 填写拒绝原因

## 安装部署

### 1. 初始化数据库

在后端项目目录下运行：

```bash
cd errand-back
node create-admin-table.js
```

这将创建管理员表并生成默认管理员账号：
- 用户名：`admin`
- 密码：`admin123`

### 2. 启动后端服务

```bash
cd errand-back
npm start
```

后端服务将在 `http://localhost:3000` 启动。

### 3. 访问管理后台

打开浏览器访问：`errand-admin/index.html`

或者使用任何静态文件服务器：

```bash
# 使用 Python
cd errand-admin
python -m http.server 8080

# 使用 Node.js http-server
npx http-server errand-admin -p 8080
```

然后访问：`http://localhost:8080`

## 使用指南

### 登录系统

1. 打开管理后台页面
2. 输入管理员用户名和密码
3. 点击"登录"按钮

默认账号：
- 用户名：`admin`
- 密码：`admin123`

**重要：首次登录后请立即修改默认密码！**

### 数据统计

登录后默认显示数据统计页面，展示：
- 用户相关统计
- 订单相关统计
- 认证相关统计

### 用户管理

1. 点击左侧菜单"用户管理"
2. 可以通过搜索框搜索用户
3. 可以通过下拉框筛选认证状态
4. 点击"查看"按钮查看用户详情
5. 点击"删除"按钮删除用户（需要超级管理员权限）

### 订单管理

1. 点击左侧菜单"订单管理"
2. 可以通过搜索框搜索订单
3. 可以通过下拉框筛选订单状态
4. 点击"查看"按钮查看订单详情
5. 点击"删除"按钮删除订单（需要超级管理员权限）

### 认证审核

1. 点击左侧菜单"认证审核"
2. 可以通过下拉框筛选认证状态
3. 点击"查看详情"查看认证申请的详细信息和证件照片
4. 对于待审核的申请：
   - 点击"通过"按钮通过认证
   - 点击"拒绝"按钮拒绝认证（需要填写拒绝原因）

## API 接口说明

### 认证相关

#### 管理员登录
```
POST /api/admin/login
Body: { username, password }
Response: { success, data: { token, admin } }
```

#### 获取当前管理员信息
```
GET /api/admin/me
Headers: Authorization: Bearer {token}
Response: { success, data: admin }
```

### 统计数据

#### 获取系统统计
```
GET /api/admin/statistics
Headers: Authorization: Bearer {token}
Response: { success, data: { users, orders, certifications } }
```

### 用户管理

#### 获取用户列表
```
GET /api/admin/users?page=1&pageSize=20&keyword=&certification_status=
Headers: Authorization: Bearer {token}
Response: { success, data: { list, total, page, pageSize } }
```

#### 获取用户详情
```
GET /api/admin/users/:id
Headers: Authorization: Bearer {token}
Response: { success, data: { user, certifications, orderStats } }
```

#### 更新用户信息
```
PUT /api/admin/users/:id
Headers: Authorization: Bearer {token}
Body: { nickname, phone, balance, ... }
Response: { success, message, data: user }
```

#### 删除用户
```
DELETE /api/admin/users/:id
Headers: Authorization: Bearer {token}
Response: { success, message }
```

### 订单管理

#### 获取订单列表
```
GET /api/admin/orders?page=1&pageSize=20&status=&keyword=
Headers: Authorization: Bearer {token}
Response: { success, data: { list, total, page, pageSize } }
```

#### 获取订单详情
```
GET /api/admin/orders/:id
Headers: Authorization: Bearer {token}
Response: { success, data: order }
```

#### 更新订单
```
PUT /api/admin/orders/:id
Headers: Authorization: Bearer {token}
Body: { status, title, description, reward, ... }
Response: { success, message, data: order }
```

#### 删除订单
```
DELETE /api/admin/orders/:id
Headers: Authorization: Bearer {token}
Response: { success, message }
```

### 认证管理

#### 获取认证列表
```
GET /api/admin/certifications?page=1&pageSize=20&status=
Headers: Authorization: Bearer {token}
Response: { success, data: { list, total, page, pageSize } }
```

#### 审核认证
```
POST /api/admin/certifications/:id/review
Headers: Authorization: Bearer {token}
Body: { status: 'approved' | 'rejected', reject_reason }
Response: { success, message, data: certification }
```

## 权限说明

### 角色类型

1. **super_admin（超级管理员）**
   - 拥有所有权限
   - 可以管理其他管理员
   - 可以删除用户和订单

2. **admin（管理员）**
   - 可以查看所有数据
   - 可以编辑用户和订单
   - 可以审核认证申请

3. **moderator（审核员）**
   - 可以查看所有数据
   - 只能审核认证申请

### 权限控制

- 所有管理员接口都需要 JWT Token 认证
- Token 在登录时获取，有效期 24 小时
- Token 需要在请求头中携带：`Authorization: Bearer {token}`
- 不同角色有不同的操作权限

## 安全建议

1. **修改默认密码**
   - 首次登录后立即修改默认管理员密码

2. **定期更换密码**
   - 建议每 3 个月更换一次管理员密码

3. **限制访问**
   - 管理后台应该只在内网或通过 VPN 访问
   - 不要将管理后台暴露在公网

4. **日志审计**
   - 定期检查管理员操作日志
   - 关注异常操作

5. **备份数据**
   - 定期备份数据库
   - 重要操作前先备份

## 常见问题

### 1. 登录失败

**问题**：输入正确的用户名密码后仍然无法登录

**解决方案**：
- 检查后端服务是否正常运行
- 检查浏览器控制台是否有错误信息
- 确认 API_BASE_URL 配置正确
- 检查数据库连接是否正常

### 2. Token 过期

**问题**：操作时提示"认证令牌已过期"

**解决方案**：
- 重新登录获取新的 Token
- Token 有效期为 24 小时

### 3. 权限不足

**问题**：某些操作提示"需要超级管理员权限"

**解决方案**：
- 确认当前账号的角色权限
- 联系超级管理员分配相应权限

### 4. 图片无法显示

**问题**：认证详情中的证件照片无法显示

**解决方案**：
- 检查后端 uploads 目录权限
- 确认图片路径配置正确
- 检查静态文件服务是否正常

## 技术栈

### 后端
- Node.js + Express
- MySQL 数据库
- JWT 认证
- bcryptjs 密码加密

### 前端
- 原生 HTML/CSS/JavaScript
- Fetch API
- LocalStorage

## 更新日志

### v1.0.0 (2026-01-04)
- ✅ 管理员登录功能
- ✅ 数据统计面板
- ✅ 用户管理（增删改查）
- ✅ 订单管理（增删改查）
- ✅ 认证审核功能
- ✅ 权限控制系统

## 联系支持

如有问题或建议，请联系技术支持团队。
