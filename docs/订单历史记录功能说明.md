# 订单历史记录功能说明

## 功能概述

订单历史记录页面显示用户的所有订单历史，包括：
- **我发布的订单**：用户作为发布者创建的所有订单
- **我接的订单**：用户作为接单者接受的所有订单

## 页面路径

`/pages/feedback/history`

注意：虽然路径名为 feedback/history，但实际显示的是订单历史记录。

## 功能特性

### 1. 统计卡片
显示四个关键指标：
- **发布总数**：用户发布的订单总数
- **今日发布**：今天发布的订单数量
- **接单总数**：用户接的订单总数
- **今日接单**：今天接的订单数量

### 2. 标签切换
- **我发布的**：显示用户发布的所有订单
- **我接的**：显示用户接受的所有订单
- 每个标签显示对应的订单数量

### 3. 订单列表
每个订单项显示：
- 订单标题
- 订单状态（待接单、已接单、进行中、已完成、已取消、已过期）
- 取货地点
- 送达地点
- 接单人/发布人（根据订单类型）
- 订单金额
- 创建/接单时间

### 4. 交互功能
- **下拉刷新**：刷新订单列表
- **上拉加载**：分页加载更多订单
- **点击订单**：跳转到订单详情页

## 订单状态

| 状态 | 图标 | 颜色 | 说明 |
|------|------|------|------|
| pending | ⏳ | #ffa502 | 待接单 |
| accepted | ✅ | #1e90ff | 已接单 |
| in_progress | 🔄 | #1e90ff | 进行中 |
| completed | ✔️ | #2ed573 | 已完成 |
| cancelled | ❌ | #ff4757 | 已取消 |
| expired | ⏰ | #747d8c | 已过期 |

## API 接口

### 获取我发布的订单
```
GET /api/orders/my-publish
```

**参数**：
- `page`: 页码（默认 1）
- `pageSize`: 每页数量（默认 20）
- `status`: 订单状态（可选）

**响应**：
```json
{
  "success": true,
  "code": 0,
  "data": {
    "list": [
      {
        "id": 1,
        "title": "订单标题",
        "pickup_location": "取货地点",
        "delivery_location": "送达地点",
        "price": 10.00,
        "status": "pending",
        "acceptor_name": "接单人姓名",
        "created_at": "2024-01-01T00:00:00.000Z"
      }
    ],
    "total": 100
  }
}
```

### 获取我接的订单
```
GET /api/orders/my-accepted
```

**参数**：
- `page`: 页码（默认 1）
- `pageSize`: 每页数量（默认 20）
- `status`: 订单状态（可选）

**响应**：
```json
{
  "success": true,
  "code": 0,
  "data": {
    "list": [
      {
        "id": 1,
        "title": "订单标题",
        "pickup_location": "取货地点",
        "delivery_location": "送达地点",
        "price": 10.00,
        "status": "accepted",
        "publisher_name": "发布人姓名",
        "accepted_at": "2024-01-01T00:00:00.000Z",
        "created_at": "2024-01-01T00:00:00.000Z"
      }
    ],
    "total": 50
  }
}
```

## 使用方法

### 进入页面
1. 从"我的"页面点击"历史记录"
2. 或直接导航到 `/pages/feedback/history`

### 查看发布的订单
1. 默认显示"我发布的"标签
2. 查看订单列表
3. 点击订单查看详情

### 查看接的订单
1. 点击"我接的"标签
2. 查看接单列表
3. 点击订单查看详情

### 刷新数据
- 下拉页面刷新
- 上拉加载更多

## 文件清单

### 前端文件
- `errand-front/pages/feedback/history.js` - 页面逻辑
- `errand-front/pages/feedback/history.wxml` - 页面结构
- `errand-front/pages/feedback/history.wxss` - 页面样式
- `errand-front/pages/feedback/history.json` - 页面配置
- `errand-front/api/order.js` - 订单 API

### 后端文件
- `errand-back/src/controllers/order.controller.js` - 订单控制器
- `errand-back/src/routes/order.routes.js` - 订单路由
- `errand-back/src/models/Order.js` - 订单模型

## 样式特点

1. **渐变统计卡片**：紫色渐变背景，醒目美观
2. **标签切换**：清晰的标签设计，显示订单数量
3. **订单卡片**：圆角卡片设计，状态徽章
4. **响应式交互**：点击缩放效果，流畅动画
5. **空状态提示**：友好的空状态提示

## 注意事项

1. **登录检查**：页面加载时会检查登录状态，未登录会提示去登录
2. **分页加载**：两个标签的数据独立分页
3. **时间格式化**：自动格式化显示相对时间（刚刚、X分钟前等）
4. **状态颜色**：不同状态使用不同颜色区分

## 后续优化建议

1. **筛选功能**
   - 按状态筛选
   - 按时间范围筛选
   - 按金额范围筛选

2. **搜索功能**
   - 搜索订单标题
   - 搜索地点

3. **统计图表**
   - 订单趋势图
   - 收入统计图

4. **批量操作**
   - 批量删除
   - 批量导出

5. **订单评价**
   - 显示订单评分
   - 快速评价入口

## 测试清单

- [ ] 页面正常加载
- [ ] 统计数据正确显示
- [ ] 标签切换正常
- [ ] 发布订单列表正常显示
- [ ] 接单列表正常显示
- [ ] 下拉刷新正常
- [ ] 上拉加载更多正常
- [ ] 点击订单跳转详情正常
- [ ] 空状态显示正常
- [ ] 未登录提示正常

## 更新日志

### 2024-01-09
- ✅ 创建订单历史记录页面
- ✅ 实现发布订单和接单的分类显示
- ✅ 添加统计卡片
- ✅ 实现标签切换
- ✅ 实现下拉刷新和上拉加载
- ✅ 优化页面样式和交互
