# 认证历史记录功能说明

## 功能概述
完善了身份认证系统的历史记录功能，用户可以查看所有认证申请的历史记录，包括审核状态、提交时间、审核时间和拒绝原因等详细信息。

## 新增功能

### 1. 历史记录入口
- 在认证页面顶部添加"查看历史记录"按钮
- 仅在用户有认证记录时显示
- 点击跳转到历史记录页面

### 2. 历史记录页面
**页面路径：** `pages/certification/history`

**主要功能：**
- 展示所有认证申请记录
- 按时间倒序排列（最新的在前）
- 支持下拉刷新
- 显示详细的认证信息

**记录卡片包含：**
- 状态标签（审核中/已通过/已拒绝）
- 认证类型（学生/教师/职工）
- 真实姓名
- 学校信息
- 学号/工号（如有）
- 学院、专业、年级（学生）
- 部门（教职工）
- 提交时间
- 审核时间（如已审核）
- 拒绝原因（如被拒绝）

**操作按钮：**
- 查看详情：弹窗显示完整信息
- 重新认证：仅在被拒绝的记录上显示，点击返回认证页面

### 3. 状态标识
使用不同颜色区分认证状态：
- 🟠 **审核中**：橙色标签
- 🟢 **已通过**：绿色标签
- 🔴 **已拒绝**：红色标签

### 4. 数据安全
- 身份证号自动脱敏显示（保留前6位和后4位）
- 仅显示用户自己的认证记录
- 需要登录才能访问

## 技术实现

### 前端文件
```
errand-front/pages/certification/
├── certification.js       # 主认证页面（已更新）
├── certification.wxml     # 主认证页面布局（已更新）
├── certification.wxss     # 主认证页面样式（已更新）
├── history.js            # 历史记录页面（新建）
├── history.wxml          # 历史记录布局（新建）
├── history.wxss          # 历史记录样式（新建）
└── history.json          # 历史记录配置（新建）
```

### 后端接口
**接口地址：** `GET /api/certification/history`

**请求头：**
```
Authorization: Bearer {token}
```

**响应格式：**
```json
{
  "success": true,
  "code": 0,
  "data": [
    {
      "id": 1,
      "type": "student",
      "real_name": "张三",
      "id_card": "110101********1234",
      "student_id": "2023001",
      "school": "XX大学",
      "college": "计算机学院",
      "major": "软件工程",
      "grade": "2023级",
      "status": "approved",
      "submitted_at": "2024-01-01T10:00:00.000Z",
      "reviewed_at": "2024-01-02T15:30:00.000Z"
    }
  ]
}
```

### API调用
```javascript
// 获取历史记录
const res = await certificationAPI.getCertificationHistory();
```

## 使用流程

### 用户操作流程
1. 进入认证页面
2. 点击"查看历史记录"按钮
3. 查看所有认证申请记录
4. 点击"查看详情"查看完整信息
5. 如有被拒绝的记录，可点击"重新认证"返回认证页面

### 数据刷新
- 进入页面自动加载
- 支持下拉刷新
- 提交新认证后自动更新

## 界面展示

### 历史记录列表
```
┌─────────────────────────────┐
│     认证历史记录              │
├─────────────────────────────┤
│ ┌─────────────────────┐     │
│ │ 学生认证      [已通过] │     │
│ │ 张三                  │     │
│ │ 学校：XX大学          │     │
│ │ 学号：2023001         │     │
│ │ 学院：计算机学院      │     │
│ │ 提交时间：2024-01-01  │     │
│ │ 审核时间：2024-01-02  │     │
│ │ [查看详情]            │     │
│ └─────────────────────┘     │
│                              │
│ ┌─────────────────────┐     │
│ │ 学生认证    [已拒绝]  │     │
│ │ 张三                  │     │
│ │ 拒绝原因：照片不清晰  │     │
│ │ [查看详情] [重新认证] │     │
│ └─────────────────────┘     │
└─────────────────────────────┘
```

## 注意事项

1. **隐私保护**
   - 身份证号自动脱敏
   - 仅显示用户自己的记录
   - 需要登录认证

2. **性能优化**
   - 按需加载数据
   - 支持下拉刷新
   - 时间格式化在前端处理

3. **用户体验**
   - 清晰的状态标识
   - 详细的信息展示
   - 便捷的操作入口

## 后续优化建议

1. **分页加载**
   - 当历史记录较多时实现分页
   - 提升加载性能

2. **筛选功能**
   - 按状态筛选（全部/审核中/已通过/已拒绝）
   - 按时间范围筛选

3. **导出功能**
   - 支持导出认证记录
   - 生成PDF证明

4. **通知提醒**
   - 审核结果推送通知
   - 站内消息提醒

## 测试建议

### 测试场景
1. 查看空历史记录
2. 查看单条记录
3. 查看多条不同状态的记录
4. 查看详情弹窗
5. 重新认证跳转
6. 下拉刷新功能
7. 身份证号脱敏显示

### 测试数据
建议创建不同状态的测试数据：
- 审核中的记录
- 已通过的记录
- 已拒绝的记录（带拒绝原因）

## 相关文件

### 前端
- `errand-front/pages/certification/certification.js`
- `errand-front/pages/certification/certification.wxml`
- `errand-front/pages/certification/certification.wxss`
- `errand-front/pages/certification/history.js`
- `errand-front/pages/certification/history.wxml`
- `errand-front/pages/certification/history.wxss`
- `errand-front/pages/certification/history.json`
- `errand-front/api/certification.js`
- `errand-front/app.json`

### 后端
- `errand-back/src/controllers/certification.controller.js`
- `errand-back/src/models/Certification.js`
- `errand-back/src/routes/certification.routes.js`

## 更新日志

**2024-01-01**
- ✅ 添加历史记录入口按钮
- ✅ 创建历史记录页面
- ✅ 实现历史记录列表展示
- ✅ 添加查看详情功能
- ✅ 添加重新认证功能
- ✅ 优化后端数据返回格式
- ✅ 实现身份证号脱敏
- ✅ 支持下拉刷新
- ✅ 完善UI样式和交互
