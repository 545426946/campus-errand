# 认证历史记录功能测试清单

## 测试准备

### 1. 创建测试数据
```bash
cd errand-back
node create-test-certifications.js
```

这将创建以下测试数据：
- ✅ 已通过的学生认证（10天前）
- ✅ 被拒绝的学生认证（5天前，带拒绝原因）
- ✅ 审核中的学生认证（1天前）
- ✅ 已通过的教师认证（15天前）

### 2. 验证数据库
```bash
node test-certification-history.js
```

## 功能测试

### 一、认证页面入口测试

#### 测试点1: 历史记录按钮显示
- [ ] 无认证记录时，不显示历史记录按钮
- [ ] 有认证记录时，显示历史记录按钮
- [ ] 按钮样式正确（蓝色边框，白色背景）
- [ ] 按钮文字和图标显示正确

#### 测试点2: 按钮点击
- [ ] 点击按钮能正确跳转到历史记录页面
- [ ] 跳转动画流畅

### 二、历史记录页面测试

#### 测试点3: 页面加载
- [ ] 进入页面显示"加载中..."提示
- [ ] 加载完成后显示记录列表
- [ ] 无记录时显示空状态提示
- [ ] 页面标题显示"认证历史记录"

#### 测试点4: 记录列表展示
- [ ] 记录按时间倒序排列（最新的在前）
- [ ] 每条记录显示完整信息
- [ ] 状态标签颜色正确：
  - 审核中：橙色
  - 已通过：绿色
  - 已拒绝：红色

#### 测试点5: 记录详情展示
**基本信息：**
- [ ] 认证类型显示正确（学生/教师/职工）
- [ ] 真实姓名显示正确
- [ ] 记录ID显示正确

**学校信息：**
- [ ] 学校名称显示正确
- [ ] 学号/工号显示正确（如有）
- [ ] 学院显示正确（学生）
- [ ] 专业显示正确（学生）
- [ ] 年级显示正确（学生）
- [ ] 部门显示正确（教职工）

**时间信息：**
- [ ] 提交时间格式正确（YYYY-MM-DD HH:mm）
- [ ] 审核时间显示正确（已审核的记录）
- [ ] 未审核的记录不显示审核时间

**拒绝信息：**
- [ ] 被拒绝的记录显示拒绝原因
- [ ] 拒绝原因样式正确（橙色背景）
- [ ] 拒绝原因文字完整显示

#### 测试点6: 身份证号脱敏
- [ ] 身份证号格式：前6位 + ******** + 后4位
- [ ] 所有记录的身份证号都已脱敏
- [ ] 脱敏后仍能识别是同一个人

#### 测试点7: 查看详情功能
- [ ] 点击"查看详情"按钮弹出详情弹窗
- [ ] 弹窗显示完整的认证信息
- [ ] 信息格式清晰易读
- [ ] 点击"知道了"关闭弹窗

#### 测试点8: 重新认证功能
- [ ] 仅在被拒绝的记录上显示"重新认证"按钮
- [ ] 已通过和审核中的记录不显示该按钮
- [ ] 点击按钮弹出确认对话框
- [ ] 确认后返回认证页面
- [ ] 取消后停留在当前页面

#### 测试点9: 下拉刷新
- [ ] 下拉页面触发刷新动画
- [ ] 刷新完成后更新数据
- [ ] 刷新完成后停止动画

### 三、后端接口测试

#### 测试点10: 历史记录接口
**请求测试：**
- [ ] 需要登录才能访问
- [ ] 未登录返回401错误
- [ ] Token过期返回401错误

**响应测试：**
- [ ] 返回格式正确（JSON）
- [ ] success字段为true
- [ ] code字段为0
- [ ] data字段为数组

**数据测试：**
- [ ] 仅返回当前用户的记录
- [ ] 记录按时间倒序排列
- [ ] 身份证号已脱敏
- [ ] 所有字段完整返回
- [ ] 时间格式正确

#### 测试点11: 错误处理
- [ ] 数据库连接失败时返回500错误
- [ ] 用户不存在时返回401错误
- [ ] 查询失败时返回友好的错误信息

### 四、UI/UX测试

#### 测试点12: 样式测试
- [ ] 页面背景色正确（#f8f8f8）
- [ ] 卡片圆角正确（16rpx）
- [ ] 卡片阴影效果正确
- [ ] 文字大小和颜色符合设计
- [ ] 间距和留白合理

#### 测试点13: 响应式测试
- [ ] 不同屏幕尺寸下显示正常
- [ ] 长文本自动换行
- [ ] 图标和文字对齐正确

#### 测试点14: 交互反馈
- [ ] 按钮点击有视觉反馈
- [ ] 加载状态提示清晰
- [ ] 错误提示友好
- [ ] 操作成功有提示

### 五、性能测试

#### 测试点15: 加载性能
- [ ] 页面加载时间 < 1秒
- [ ] 数据请求时间 < 500ms
- [ ] 列表渲染流畅

#### 测试点16: 数据量测试
- [ ] 10条记录加载正常
- [ ] 50条记录加载正常
- [ ] 100条记录加载正常
- [ ] 大量数据时考虑分页

### 六、兼容性测试

#### 测试点17: 平台兼容
- [ ] iOS微信小程序正常
- [ ] Android微信小程序正常
- [ ] 微信开发者工具正常

#### 测试点18: 版本兼容
- [ ] 微信基础库 2.0+ 正常
- [ ] 微信基础库 3.0+ 正常

### 七、安全测试

#### 测试点19: 数据安全
- [ ] 身份证号已脱敏
- [ ] 无法查看其他用户的记录
- [ ] Token验证正确
- [ ] SQL注入防护

#### 测试点20: 权限控制
- [ ] 需要登录才能访问
- [ ] 仅能查看自己的记录
- [ ] 管理员权限隔离

## 测试用例

### 用例1: 查看空历史记录
**前置条件：** 用户无认证记录
**操作步骤：**
1. 登录系统
2. 进入认证页面
3. 观察页面显示

**预期结果：**
- 不显示"查看历史记录"按钮
- 显示认证表单

### 用例2: 查看有记录的历史
**前置条件：** 用户有认证记录
**操作步骤：**
1. 登录系统
2. 进入认证页面
3. 点击"查看历史记录"按钮
4. 查看历史记录列表

**预期结果：**
- 显示所有认证记录
- 记录按时间倒序排列
- 状态标签颜色正确
- 信息显示完整

### 用例3: 查看被拒绝记录的详情
**前置条件：** 用户有被拒绝的认证记录
**操作步骤：**
1. 进入历史记录页面
2. 找到被拒绝的记录
3. 点击"查看详情"按钮

**预期结果：**
- 弹出详情对话框
- 显示完整信息
- 显示拒绝原因

### 用例4: 重新认证
**前置条件：** 用户有被拒绝的认证记录
**操作步骤：**
1. 进入历史记录页面
2. 找到被拒绝的记录
3. 点击"重新认证"按钮
4. 确认对话框

**预期结果：**
- 返回认证页面
- 可以重新填写表单

### 用例5: 下拉刷新
**前置条件：** 在历史记录页面
**操作步骤：**
1. 下拉页面
2. 等待刷新完成

**预期结果：**
- 显示刷新动画
- 数据重新加载
- 动画停止

## 测试报告模板

### 测试环境
- 测试时间：YYYY-MM-DD
- 测试人员：
- 测试设备：
- 微信版本：
- 基础库版本：

### 测试结果
- 总测试点：20
- 通过：
- 失败：
- 阻塞：

### 问题列表
| 编号 | 问题描述 | 严重程度 | 状态 |
|------|---------|---------|------|
| 1    |         | 高/中/低 | 待修复 |

### 测试结论
- [ ] 通过，可以发布
- [ ] 有问题，需要修复
- [ ] 阻塞，无法继续

## 自动化测试建议

### 单元测试
```javascript
// 测试时间格式化函数
describe('formatTime', () => {
  it('should format date correctly', () => {
    const result = formatTime('2024-01-01T10:30:00.000Z');
    expect(result).toBe('2024-01-01 10:30');
  });
});

// 测试身份证号脱敏
describe('maskIdCard', () => {
  it('should mask id card correctly', () => {
    const result = maskIdCard('110101199001011234');
    expect(result).toBe('110101********1234');
  });
});
```

### 接口测试
```javascript
// 测试历史记录接口
describe('GET /api/certification/history', () => {
  it('should return history list', async () => {
    const res = await request(app)
      .get('/api/certification/history')
      .set('Authorization', `Bearer ${token}`);
    
    expect(res.status).toBe(200);
    expect(res.body.success).toBe(true);
    expect(Array.isArray(res.body.data)).toBe(true);
  });
});
```

## 注意事项

1. **测试数据隔离**
   - 使用独立的测试账号
   - 测试完成后清理数据

2. **真实场景模拟**
   - 模拟不同的网络状况
   - 模拟不同的数据量
   - 模拟异常情况

3. **用户体验关注**
   - 关注加载速度
   - 关注交互流畅度
   - 关注错误提示友好度

4. **安全性验证**
   - 验证权限控制
   - 验证数据脱敏
   - 验证SQL注入防护
