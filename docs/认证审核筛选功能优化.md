# 认证审核筛选功能优化

## 更新时间
2026-01-05

## 优化内容

### 前端改进 (errand-admin)

#### 1. 新增筛选条件
- **关键词搜索**：支持搜索姓名、学号、学校等信息
- **认证类型筛选**：可按学生认证、教师认证、职工认证筛选
- **认证状态筛选**：可按待审核、已通过、已拒绝筛选
- **重置按钮**：一键清空所有筛选条件

#### 2. 界面优化
```html
<div class="search-bar">
  <input type="text" id="certSearch" placeholder="搜索姓名、学号、学校...">
  <select id="certTypeFilter">
    <option value="">全部类型</option>
    <option value="student">学生认证</option>
    <option value="teacher">教师认证</option>
    <option value="staff">职工认证</option>
  </select>
  <select id="certStatusFilter">
    <option value="">全部状态</option>
    <option value="pending">待审核</option>
    <option value="approved">已通过</option>
    <option value="rejected">已拒绝</option>
  </select>
  <button class="btn btn-primary" onclick="searchCertifications()">搜索</button>
  <button class="btn btn-warning" onclick="resetCertFilters()">重置</button>
</div>
```

#### 3. JavaScript 功能增强
- `loadCertifications()` 方法现在支持 keyword、type、status 三个参数
- 新增 `resetCertFilters()` 方法用于重置筛选条件
- 完善了职工认证类型的显示

### 后端改进 (errand-back)

#### 1. API 参数扩展
`GET /api/admin/certifications` 接口现在支持以下查询参数：

| 参数 | 类型 | 说明 | 示例 |
|------|------|------|------|
| page | number | 页码 | 1 |
| pageSize | number | 每页数量 | 20 |
| status | string | 认证状态 | pending/approved/rejected |
| type | string | 认证类型 | student/teacher/staff |
| keyword | string | 关键词搜索 | 张三 |

#### 2. 搜索范围
关键词搜索支持以下字段：
- 真实姓名 (real_name)
- 学号/工号 (student_id)
- 学校名称 (school)
- 用户名 (username)
- 昵称 (nickname)

#### 3. SQL 优化
```sql
SELECT c.*, u.username, u.nickname, u.avatar 
FROM certifications c
LEFT JOIN users u ON c.user_id = u.id
WHERE 1=1
  AND c.status = ?                    -- 状态筛选
  AND c.type = ?                      -- 类型筛选
  AND (c.real_name LIKE ? OR          -- 关键词搜索
       c.student_id LIKE ? OR 
       c.school LIKE ? OR 
       u.username LIKE ? OR 
       u.nickname LIKE ?)
ORDER BY c.submitted_at DESC
LIMIT ? OFFSET ?
```

## 使用说明

### 管理员操作流程

1. **登录管理后台**
   - 访问管理员页面
   - 使用管理员账号登录

2. **进入认证审核页面**
   - 点击左侧菜单"认证审核"

3. **使用筛选功能**
   - **按状态筛选**：选择"待审核"查看需要处理的申请
   - **按类型筛选**：选择"学生认证"只查看学生的申请
   - **关键词搜索**：输入姓名、学号或学校名称快速查找
   - **组合筛选**：可以同时使用多个筛选条件
   - **重置筛选**：点击"重置"按钮清空所有筛选条件

4. **审核操作**
   - 点击"查看详情"查看完整的认证信息
   - 点击"通过"批准认证申请
   - 点击"拒绝"并输入拒绝原因

## 测试建议

### 功能测试
1. 测试单个筛选条件是否生效
2. 测试多个筛选条件组合使用
3. 测试关键词搜索的准确性
4. 测试重置按钮是否正常工作
5. 测试分页功能是否正常

### 边界测试
1. 空关键词搜索
2. 特殊字符搜索
3. 超长关键词搜索
4. 无结果的筛选条件

## 技术细节

### 前端实现
- 使用原生 JavaScript 实现
- 通过 URLSearchParams 构建查询参数
- 支持实时筛选和分页

### 后端实现
- 使用参数化查询防止 SQL 注入
- 动态构建 WHERE 子句
- 支持模糊搜索（LIKE）

## 后续优化建议

1. **时间范围筛选**：添加提交时间的日期范围筛选
2. **批量操作**：支持批量审核多个申请
3. **导出功能**：支持导出筛选结果为 Excel
4. **高级搜索**：添加更多搜索字段（学院、专业、年级等）
5. **搜索历史**：记录常用的搜索条件
6. **快捷筛选**：添加"今日提交"、"本周提交"等快捷按钮

## 相关文件

### 前端文件
- `errand-admin/index.html` - 管理员界面
- `errand-admin/admin.js` - 管理员逻辑

### 后端文件
- `errand-back/src/controllers/admin.controller.js` - 管理员控制器
- `errand-back/src/routes/admin.routes.js` - 管理员路由

## 版本历史

- **v1.1** (2026-01-05)
  - 新增关键词搜索功能
  - 新增认证类型筛选
  - 新增重置按钮
  - 完善职工认证类型支持
  - 优化后端查询逻辑

- **v1.0** (初始版本)
  - 基础的状态筛选功能
