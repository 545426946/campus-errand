<view class="page-container">
  <!-- 步骤指示器 -->
  <view class="step-indicator">
    <view class="step-item {{currentStep >= 1 ? 'active' : ''}}">
      <view class="step-number">1</view>
      <text class="step-text">填写信息</text>
    </view>
    <view class="step-line {{currentStep >= 2 ? 'active' : ''}}"></view>
    <view class="step-item {{currentStep >= 2 ? 'active' : ''}}">
      <view class="step-number">2</view>
      <text class="step-text">上传照片</text>
    </view>
    <view class="step-line {{currentStep >= 3 ? 'active' : ''}}"></view>
    <view class="step-item {{currentStep >= 3 ? 'active' : ''}}">
      <view class="step-number">3</view>
      <text class="step-text">提交审核</text>
    </view>
  </view>

  <!-- 步骤1: 填写信息 -->
  <view class="step-content" wx:if="{{currentStep === 1}}">
    <view class="form-section">
      <view class="section-title">基本信息</view>
      
      <view class="form-item">
        <text class="form-label">真实姓名</text>
        <input class="form-input {{errors.realName ? 'error' : ''}}"
               placeholder="请输入真实姓名"
               value="{{formData.realName}}"
               bindinput="onInputChange"
               data-field="realName"
               maxlength="20" />
        <text class="error-text" wx:if="{{errors.realName}}">{{errors.realName}}</text>
      </view>

      <view class="form-item">
        <text class="form-label">身份证号</text>
        <input class="form-input {{errors.idCard ? 'error' : ''}}"
               placeholder="请输入身份证号"
               value="{{formData.idCard}}"
               bindinput="onInputChange"
               data-field="idCard"
               maxlength="18" />
        <text class="error-text" wx:if="{{errors.idCard}}">{{errors.idCard}}</text>
      </view>

      <view class="tips-section">
        <view class="tips-title">
          <text class="tips-icon">⚠️</text>
          <text class="tips-text">注意事项</text>
        </view>
        <view class="tips-list">
          <text class="tips-item">• 请确保填写的姓名与身份证上的一致</text>
          <text class="tips-item">• 身份证号将严格保密，仅用于实名认证</text>
          <text class="tips-item">• 认证成功后，姓名不可修改</text>
        </view>
      </view>
    </view>

    <view class="action-section">
      <button class="primary-btn" bindtap="onNextStep">下一步</button>
    </view>
  </view>

  <!-- 步骤2: 上传照片 -->
  <view class="step-content" wx:if="{{currentStep === 2}}">
    <view class="upload-section">
      <view class="section-title">身份证照片</view>
      
      <view class="upload-grid">
        <view class="upload-item">
          <text class="upload-label">身份证正面</text>
          <view class="upload-area {{formData.idCardFront ? 'has-image' : ''}}"
                bindtap="onUploadIdCardFront"
                wx:if="{{!formData.idCardFront}}">
            <text class="upload-icon">📷</text>
            <text class="upload-text">点击上传</text>
            <text class="upload-desc">拍摄身份证正面照片</text>
          </view>
          
          <view class="image-preview" wx:else>
            <image class="preview-image" 
                   src="{{formData.idCardFront}}" 
                   mode="aspectFill"
                   bindtap="onPreviewImage"
                   data-url="{{formData.idCardFront}}"></image>
            <view class="image-actions">
              <text class="delete-btn" 
                    bindtap="onDeleteImage"
                    data-field="idCardFront">删除</text>
            </view>
          </view>
        </view>

        <view class="upload-item">
          <text class="upload-label">身份证背面</text>
          <view class="upload-area {{formData.idCardBack ? 'has-image' : ''}}"
                bindtap="onUploadIdCardBack"
                wx:if="{{!formData.idCardBack}}">
            <text class="upload-icon">📷</text>
            <text class="upload-text">点击上传</text>
            <text class="upload-desc">拍摄身份证背面照片</text>
          </view>
          
          <view class="image-preview" wx:else>
            <image class="preview-image" 
                   src="{{formData.idCardBack}}" 
                   mode="aspectFill"
                   bindtap="onPreviewImage"
                   data-url="{{formData.idCardBack}}"></image>
            <view class="image-actions">
              <text class="delete-btn" 
                    bindtap="onDeleteImage"
                    data-field="idCardBack">删除</text>
            </view>
          </view>
        </view>
      </view>

      <view class="tips-section">
        <view class="tips-title">
          <text class="tips-icon">📸</text>
          <text class="tips-text">拍摄要求</text>
        </view>
        <view class="tips-list">
          <text class="tips-item">• 请确保身份证照片清晰、完整</text>
          <text class="tips-item">• 避免反光、模糊、遮挡</text>
          <text class="tips-item">• 请在光线充足的环境下拍摄</text>
          <text class="tips-item">• 照片中身份证四角需完整显示</text>
        </view>
      </view>
    </view>

    <view class="action-section">
      <button class="secondary-btn" bindtap="onPrevStep">上一步</button>
      <button class="primary-btn" bindtap="onNextStep">下一步</button>
    </view>
  </view>

  <!-- 步骤3: 提交审核 -->
  <view class="step-content" wx:if="{{currentStep === 3}}">
    <view class="summary-section">
      <view class="section-title">确认信息</view>
      
      <view class="info-card">
        <view class="info-item">
          <text class="info-label">真实姓名</text>
          <text class="info-value">{{formData.realName}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">身份证号</text>
          <text class="info-value">{{formData.idCard}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">身份证照片</text>
          <text class="info-value">已上传</text>
        </view>
      </view>

      <view class="notice-section">
        <view class="notice-title">
          <text class="notice-icon">📋</text>
          <text class="notice-text">认证说明</text>
        </view>
        <view class="notice-content">
          <text class="notice-item">• 实名认证通过后，您将获得更多平台特权</text>
          <text class="notice-item">• 认证信息将在1-3个工作日内完成审核</text>
          <text class="notice-item">• 如有疑问，请联系客服</text>
        </view>
      </view>
    </view>

    <view class="action-section">
      <button class="secondary-btn" bindtap="onPrevStep">上一步</button>
      <button class="primary-btn {{submitting ? 'loading' : ''}}" 
              bindtap="onSubmitCertification"
              disabled="{{submitting}}">
        {{submitting ? '提交中...' : '提交认证'}}
      </button>
    </view>
  </view>

  <!-- 认证成功状态 -->
  <view class="result-content" wx:if="{{currentStep === 4 && certificationStatus === 'verified'}}">
    <view class="result-icon success">✅</view>
    <text class="result-title">认证成功</text>
    <text class="result-desc">您的实名认证已通过审核</text>
    
    <view class="cert-info">
      <view class="cert-item">
        <text class="cert-label">认证姓名</text>
        <text class="cert-value">{{certificationInfo.realName}}</text>
      </view>
      <view class="cert-item">
        <text class="cert-label">认证时间</text>
        <text class="cert-value">{{certificationInfo.certifyTime}}</text>
      </view>
    </view>
  </view>

  <!-- 审核中状态 -->
  <view class="result-content" wx:if="{{currentStep === 3 && certificationStatus === 'pending'}}">
    <view class="result-icon pending">⏳</view>
    <text class="result-title">审核中</text>
    <text class="result-desc">您的实名认证正在审核中</text>
    
    <view class="pending-info">
      <text class="pending-item">• 预计1-3个工作日内完成审核</text>
      <text class="pending-item">• 请耐心等待，不要重复提交</text>
      <text class="pending-item">• 如有问题请联系客服</text>
    </view>
  </view>
</view>