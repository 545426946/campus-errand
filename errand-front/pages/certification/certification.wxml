<view class="certification-page">
  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 历史记录按钮 -->
  <view class="history-btn-wrapper" wx:if="{{!loading && certStatus !== 'none'}}">
    <button class="history-btn" bindtap="onViewHistory">
      <text class="history-icon">📋</text>
      <text>查看历史记录</text>
    </button>
  </view>

  <!-- 已认证状态 -->
  <view class="cert-status approved" wx:if="{{isCertified && certStatus === 'approved'}}">
    <view class="status-icon">✓</view>
    <view class="status-text">
      <text class="status-title">骑手认证已通过</text>
      <text class="status-desc">您已完成骑手身份认证，可以接单了</text>
    </view>
    <view class="cert-info">
      <view class="info-item">
        <text class="label">真实姓名：</text>
        <text class="value">{{certDetail.realName}}</text>
      </view>
      <view class="info-item">
        <text class="label">认证时间：</text>
        <text class="value">{{certDetail.reviewedAt}}</text>
      </view>
    </view>
  </view>

  <!-- 审核中状态 -->
  <view class="cert-status pending" wx:if="{{certStatus === 'pending'}}">
    <view class="status-icon">⏳</view>
    <view class="status-text">
      <text class="status-title">审核中</text>
      <text class="status-desc">您的骑手认证申请正在审核中，请耐心等待</text>
    </view>
    <view class="cert-info">
      <view class="info-item">
        <text class="label">提交时间：</text>
        <text class="value">{{certDetail.submittedAt}}</text>
      </view>
    </view>
  </view>

  <!-- 审核拒绝状态 -->
  <view class="cert-status rejected" wx:if="{{certStatus === 'rejected'}}">
    <view class="status-icon">✗</view>
    <view class="status-text">
      <text class="status-title">认证未通过</text>
      <text class="status-desc">{{certDetail.rejectReason || '请查看拒绝原因后重新提交'}}</text>
    </view>
    <button class="reapply-btn" bindtap="onReapply">重新认证</button>
  </view>

  <!-- 认证表单 -->
  <view class="cert-form" wx:if="{{certStatus === 'none' || certStatus === 'rejected'}}">
    <view class="form-section">
      <view class="section-title">骑手基本信息</view>

      <!-- 真实姓名 -->
      <view class="form-item">
        <text class="label required">真实姓名</text>
        <input class="input" placeholder="请输入真实姓名" value="{{form.realName}}" data-field="realName" bindinput="onInputChange" />
      </view>

      <!-- 身份证号 -->
      <view class="form-item">
        <text class="label required">身份证号</text>
        <input class="input" placeholder="请输入身份证号" value="{{form.idCard}}" data-field="idCard" bindinput="onInputChange" maxlength="18" />
      </view>

      <!-- 联系电话 -->
      <view class="form-item">
        <text class="label required">联系电话</text>
        <input class="input" type="number" placeholder="请输入手机号" value="{{form.phone}}" data-field="phone" bindinput="onInputChange" maxlength="11" />
      </view>
    </view>

    <!-- 紧急联系人 -->
    <view class="form-section">
      <view class="section-title">紧急联系人（选填）</view>

      <view class="form-item">
        <text class="label">紧急联系人</text>
        <input class="input" placeholder="请输入紧急联系人姓名" value="{{form.emergencyContact}}" data-field="emergencyContact" bindinput="onInputChange" />
      </view>

      <view class="form-item">
        <text class="label">紧急联系电话</text>
        <input class="input" type="number" placeholder="请输入紧急联系人电话" value="{{form.emergencyPhone}}" data-field="emergencyPhone" bindinput="onInputChange" maxlength="11" />
      </view>
    </view>

    <!-- 证件照片 -->
    <view class="form-section">
      <view class="section-title">证件照片</view>
      <view class="section-desc">请上传清晰的证件照片，确保信息可见</view>

      <!-- 身份证正面 -->
      <view class="upload-item">
        <text class="label required">身份证正面（人像面）</text>
        <view class="upload-box" bindtap="onUploadImage" data-type="idCardFront">
          <image wx:if="{{form.idCardFront}}" class="upload-image" src="{{form.idCardFront}}" mode="aspectFill" catchtap="onPreviewImage" data-url="{{form.idCardFront}}" />
          <view wx:else class="upload-placeholder">
            <text class="upload-icon">+</text>
            <text class="upload-text">上传身份证正面</text>
          </view>
        </view>
      </view>

      <!-- 身份证背面 -->
      <view class="upload-item">
        <text class="label required">身份证背面（国徽面）</text>
        <view class="upload-box" bindtap="onUploadImage" data-type="idCardBack">
          <image wx:if="{{form.idCardBack}}" class="upload-image" src="{{form.idCardBack}}" mode="aspectFill" catchtap="onPreviewImage" data-url="{{form.idCardBack}}" />
          <view wx:else class="upload-placeholder">
            <text class="upload-icon">+</text>
            <text class="upload-text">上传身份证背面</text>
          </view>
        </view>
      </view>

      <!-- 健康证（可选） -->
      <view class="upload-item">
        <text class="label">健康证（选填）</text>
        <view class="upload-box" bindtap="onUploadImage" data-type="healthCert">
          <image wx:if="{{form.healthCert}}" class="upload-image" src="{{form.healthCert}}" mode="aspectFill" catchtap="onPreviewImage" data-url="{{form.healthCert}}" />
          <view wx:else class="upload-placeholder">
            <text class="upload-icon">+</text>
            <text class="upload-text">上传健康证</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view class="submit-section">
      <button class="submit-btn" bindtap="onSubmit" disabled="{{submitting}}">
        {{submitting ? '提交中...' : '提交骑手认证'}}
      </button>
      <view class="tips">
        <text class="tips-title">温馨提示：</text>
        <text class="tips-text">1. 请确保填写的信息真实准确</text>
        <text class="tips-text">2. 上传的证件照片需清晰可见</text>
        <text class="tips-text">3. 认证通过后方可接单配送</text>
        <text class="tips-text">4. 健康证为选填项，有助于提高审核通过率</text>
      </view>
    </view>
  </view>
</view>
