<view class="certification-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å†å²è®°å½•æŒ‰é’® -->
  <view class="history-btn-wrapper" wx:if="{{!loading && certStatus !== 'none'}}">
    <button class="history-btn" bindtap="onViewHistory">
      <text class="history-icon">ğŸ“‹</text>
      <text>æŸ¥çœ‹å†å²è®°å½•</text>
    </button>
  </view>

  <!-- å·²è®¤è¯çŠ¶æ€ -->
  <view class="cert-status approved" wx:if="{{isCertified && certStatus === 'approved'}}">
    <view class="status-icon">âœ“</view>
    <view class="status-text">
      <text class="status-title">è®¤è¯å·²é€šè¿‡</text>
      <text class="status-desc">æ‚¨å·²å®Œæˆ{{certDetail.certificationType === 'student' ? 'å­¦ç”Ÿ' : certDetail.certificationType === 'teacher' ? 'æ•™å¸ˆ' : 'èŒå·¥'}}èº«ä»½è®¤è¯</text>
    </view>
    <view class="cert-info">
      <view class="info-item">
        <text class="label">çœŸå®å§“åï¼š</text>
        <text class="value">{{certDetail.realName}}</text>
      </view>
      <view class="info-item">
        <text class="label">å­¦æ ¡ï¼š</text>
        <text class="value">{{certDetail.school}}</text>
      </view>
      <view class="info-item">
        <text class="label">è®¤è¯æ—¶é—´ï¼š</text>
        <text class="value">{{certDetail.reviewedAt}}</text>
      </view>
    </view>
  </view>

  <!-- å®¡æ ¸ä¸­çŠ¶æ€ -->
  <view class="cert-status pending" wx:if="{{certStatus === 'pending'}}">
    <view class="status-icon">â³</view>
    <view class="status-text">
      <text class="status-title">å®¡æ ¸ä¸­</text>
      <text class="status-desc">æ‚¨çš„è®¤è¯ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…</text>
    </view>
    <view class="cert-info">
      <view class="info-item">
        <text class="label">æäº¤æ—¶é—´ï¼š</text>
        <text class="value">{{certDetail.submittedAt}}</text>
      </view>
    </view>
  </view>

  <!-- å®¡æ ¸æ‹’ç»çŠ¶æ€ -->
  <view class="cert-status rejected" wx:if="{{certStatus === 'rejected'}}">
    <view class="status-icon">âœ—</view>
    <view class="status-text">
      <text class="status-title">è®¤è¯æœªé€šè¿‡</text>
      <text class="status-desc">{{certDetail.rejectReason || 'è¯·æŸ¥çœ‹æ‹’ç»åŸå› åé‡æ–°æäº¤'}}</text>
    </view>
    <button class="reapply-btn" bindtap="onReapply">é‡æ–°è®¤è¯</button>
  </view>

  <!-- è®¤è¯è¡¨å• -->
  <view class="cert-form" wx:if="{{certStatus === 'none' || certStatus === 'rejected'}}">
    <view class="form-section">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>

      <!-- è®¤è¯ç±»å‹ -->
      <view class="form-item">
        <text class="label required">è®¤è¯ç±»å‹</text>
        <picker mode="selector" range="{{typeOptions}}" range-key="label" value="{{form.type}}" bindchange="onTypeChange">
          <view class="picker">
            {{typeOptions[form.type === 'student' ? 0 : form.type === 'teacher' ? 1 : 2].label}}
          </view>
        </picker>
      </view>

      <!-- çœŸå®å§“å -->
      <view class="form-item">
        <text class="label required">çœŸå®å§“å</text>
        <input class="input" placeholder="è¯·è¾“å…¥çœŸå®å§“å" value="{{form.realName}}" data-field="realName" bindinput="onInputChange" />
      </view>

      <!-- èº«ä»½è¯å· -->
      <view class="form-item">
        <text class="label required">èº«ä»½è¯å·</text>
        <input class="input" placeholder="è¯·è¾“å…¥èº«ä»½è¯å·" value="{{form.idCard}}" data-field="idCard" bindinput="onInputChange" maxlength="18" />
      </view>

      <!-- å­¦å·/å·¥å· -->
      <view class="form-item" wx:if="{{form.type === 'student' || form.type === 'teacher' || form.type === 'staff'}}">
        <text class="label {{form.type === 'student' ? 'required' : ''}}">{{form.type === 'student' ? 'å­¦å·' : 'å·¥å·'}}</text>
        <input class="input" placeholder="è¯·è¾“å…¥{{form.type === 'student' ? 'å­¦å·' : 'å·¥å·'}}" value="{{form.studentId}}" data-field="studentId" bindinput="onInputChange" />
      </view>

      <!-- å­¦æ ¡ -->
      <view class="form-item">
        <text class="label required">å­¦æ ¡åç§°</text>
        <input class="input" placeholder="è¯·è¾“å…¥å­¦æ ¡åç§°" value="{{form.school}}" data-field="school" bindinput="onInputChange" />
      </view>
    </view>

    <!-- å­¦ç”Ÿä¿¡æ¯ -->
    <view class="form-section" wx:if="{{form.type === 'student'}}">
      <view class="section-title">å­¦ç”Ÿä¿¡æ¯</view>

      <view class="form-item">
        <text class="label">å­¦é™¢</text>
        <input class="input" placeholder="è¯·è¾“å…¥å­¦é™¢" value="{{form.college}}" data-field="college" bindinput="onInputChange" />
      </view>

      <view class="form-item">
        <text class="label">ä¸“ä¸š</text>
        <input class="input" placeholder="è¯·è¾“å…¥ä¸“ä¸š" value="{{form.major}}" data-field="major" bindinput="onInputChange" />
      </view>

      <view class="form-item">
        <text class="label">å¹´çº§</text>
        <input class="input" placeholder="å¦‚ï¼š2023çº§" value="{{form.grade}}" data-field="grade" bindinput="onInputChange" />
      </view>
    </view>

    <!-- æ•™èŒå·¥ä¿¡æ¯ -->
    <view class="form-section" wx:if="{{form.type === 'teacher' || form.type === 'staff'}}">
      <view class="section-title">{{form.type === 'teacher' ? 'æ•™å¸ˆ' : 'èŒå·¥'}}ä¿¡æ¯</view>

      <view class="form-item">
        <text class="label">éƒ¨é—¨</text>
        <input class="input" placeholder="è¯·è¾“å…¥æ‰€åœ¨éƒ¨é—¨" value="{{form.department}}" data-field="department" bindinput="onInputChange" />
      </view>
    </view>

    <!-- è¯ä»¶ç…§ç‰‡ -->
    <view class="form-section">
      <view class="section-title">è¯ä»¶ç…§ç‰‡</view>
      <view class="section-desc">è¯·ä¸Šä¼ æ¸…æ™°çš„è¯ä»¶ç…§ç‰‡ï¼Œç¡®ä¿ä¿¡æ¯å¯è§</view>

      <!-- èº«ä»½è¯æ­£é¢ -->
      <view class="upload-item">
        <text class="label">èº«ä»½è¯æ­£é¢</text>
        <view class="upload-box" bindtap="onUploadImage" data-type="idCardFront">
          <image wx:if="{{form.idCardFront}}" class="upload-image" src="{{form.idCardFront}}" mode="aspectFill" bindtap="onPreviewImage" data-url="{{form.idCardFront}}" />
          <view wx:else class="upload-placeholder">
            <text class="upload-icon">+</text>
            <text class="upload-text">ä¸Šä¼ èº«ä»½è¯æ­£é¢</text>
          </view>
        </view>
      </view>

      <!-- èº«ä»½è¯èƒŒé¢ -->
      <view class="upload-item">
        <text class="label">èº«ä»½è¯èƒŒé¢</text>
        <view class="upload-box" bindtap="onUploadImage" data-type="idCardBack">
          <image wx:if="{{form.idCardBack}}" class="upload-image" src="{{form.idCardBack}}" mode="aspectFill" bindtap="onPreviewImage" data-url="{{form.idCardBack}}" />
          <view wx:else class="upload-placeholder">
            <text class="upload-icon">+</text>
            <text class="upload-text">ä¸Šä¼ èº«ä»½è¯èƒŒé¢</text>
          </view>
        </view>
      </view>

      <!-- å­¦ç”Ÿè¯/å·¥ä½œè¯ -->
      <view class="upload-item">
        <text class="label">{{form.type === 'student' ? 'å­¦ç”Ÿè¯' : 'å·¥ä½œè¯'}}</text>
        <view class="upload-box" bindtap="onUploadImage" data-type="studentCard">
          <image wx:if="{{form.studentCard}}" class="upload-image" src="{{form.studentCard}}" mode="aspectFill" bindtap="onPreviewImage" data-url="{{form.studentCard}}" />
          <view wx:else class="upload-placeholder">
            <text class="upload-icon">+</text>
            <text class="upload-text">ä¸Šä¼ {{form.type === 'student' ? 'å­¦ç”Ÿè¯' : 'å·¥ä½œè¯'}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
      <button class="submit-btn" bindtap="onSubmit" disabled="{{submitting}}">
        {{submitting ? 'æäº¤ä¸­...' : 'æäº¤è®¤è¯'}}
      </button>
      <view class="tips">
        <text class="tips-title">æ¸©é¦¨æç¤ºï¼š</text>
        <text class="tips-text">1. è¯·ç¡®ä¿å¡«å†™çš„ä¿¡æ¯çœŸå®å‡†ç¡®</text>
        <text class="tips-text">2. ä¸Šä¼ çš„è¯ä»¶ç…§ç‰‡éœ€æ¸…æ™°å¯è§</text>
        <text class="tips-text">3. è®¤è¯é€šè¿‡åæ–¹å¯å‘å¸ƒå’Œæ¥å•</text>
      </view>
    </view>
  </view>
</view>
