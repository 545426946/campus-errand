<view class="history-page">
  <!-- å¯¼èˆªæ  -->
  <view class="nav-bar">
    <text class="nav-title">è®¤è¯å†å²è®°å½•</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && historyList.length === 0}}">
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view class="history-list" wx:if="{{!loading && historyList.length > 0}}">
    <view class="history-item {{item.status}}" wx:for="{{historyList}}" wx:key="id">
      <!-- çŠ¶æ€æ ‡ç­¾ -->
      <view class="status-badge {{item.status}}">
        <text wx:if="{{item.status === 'pending'}}">å®¡æ ¸ä¸­</text>
        <text wx:if="{{item.status === 'approved'}}">å·²é€šè¿‡</text>
        <text wx:if="{{item.status === 'rejected'}}">å·²æ‹’ç»</text>
      </view>

      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="item-header">
        <view class="header-left">
          <text class="cert-type">
            {{item.type === 'student' ? 'å­¦ç”Ÿè®¤è¯' : item.type === 'teacher' ? 'æ•™å¸ˆè®¤è¯' : 'èŒå·¥è®¤è¯'}}
          </text>
          <text class="cert-name">{{item.real_name}}</text>
        </view>
        <view class="header-right">
          <text class="cert-id">ID: {{item.id}}</text>
        </view>
      </view>

      <!-- è¯¦ç»†ä¿¡æ¯ -->
      <view class="item-content">
        <view class="info-row">
          <text class="info-label">å­¦æ ¡ï¼š</text>
          <text class="info-value">{{item.school}}</text>
        </view>
        
        <view class="info-row" wx:if="{{item.student_id}}">
          <text class="info-label">{{item.type === 'student' ? 'å­¦å·' : 'å·¥å·'}}ï¼š</text>
          <text class="info-value">{{item.student_id}}</text>
        </view>

        <view class="info-row" wx:if="{{item.college}}">
          <text class="info-label">å­¦é™¢ï¼š</text>
          <text class="info-value">{{item.college}}</text>
        </view>

        <view class="info-row" wx:if="{{item.major}}">
          <text class="info-label">ä¸“ä¸šï¼š</text>
          <text class="info-value">{{item.major}}</text>
        </view>

        <view class="info-row" wx:if="{{item.grade}}">
          <text class="info-label">å¹´çº§ï¼š</text>
          <text class="info-value">{{item.grade}}</text>
        </view>

        <view class="info-row" wx:if="{{item.department}}">
          <text class="info-label">éƒ¨é—¨ï¼š</text>
          <text class="info-value">{{item.department}}</text>
        </view>
      </view>

      <!-- æ—¶é—´ä¿¡æ¯ -->
      <view class="item-footer">
        <view class="time-info">
          <text class="time-label">æäº¤æ—¶é—´ï¼š</text>
          <text class="time-value">{{item.submitted_at}}</text>
        </view>
        
        <view class="time-info" wx:if="{{item.reviewed_at}}">
          <text class="time-label">å®¡æ ¸æ—¶é—´ï¼š</text>
          <text class="time-value">{{item.reviewed_at}}</text>
        </view>

        <!-- æ‹’ç»åŸå›  -->
        <view class="reject-reason" wx:if="{{item.status === 'rejected' && item.reject_reason}}">
          <text class="reason-label">æ‹’ç»åŸå› ï¼š</text>
          <text class="reason-value">{{item.reject_reason}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="item-actions">
        <button class="action-btn detail-btn" bindtap="onViewDetail" data-item="{{item}}">
          æŸ¥çœ‹è¯¦æƒ…
        </button>
        <button class="action-btn reapply-btn" wx:if="{{item.status === 'rejected'}}" bindtap="onReapply">
          é‡æ–°è®¤è¯
        </button>
      </view>
    </view>
  </view>
</view>
