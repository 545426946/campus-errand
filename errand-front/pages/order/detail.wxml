<!--è®¢å•è¯¦æƒ…é¡µé¢-->
<view class="container">
  <view wx:if="{{orderDetail}}" class="detail-container">
    
    <!-- è®¢å•çŠ¶æ€ -->
    <view class="status-card">
      <view class="status-decoration"></view>
      <view class="status-icon status-{{orderDetail.status}}">
        <text wx:if="{{orderDetail.status === 'pending'}}">â°</text>
        <text wx:if="{{orderDetail.status === 'accepted'}}">ğŸš€</text>
        <text wx:if="{{orderDetail.status === 'completed'}}">âœ…</text>
        <text wx:if="{{orderDetail.status === 'cancelled'}}">âŒ</text>
      </view>
      <view class="status-text">{{orderDetail.statusText}}</view>
      <view class="status-desc">{{orderDetail.status === 'pending' ? 'ç­‰å¾…æ¥å•ä¸­' : orderDetail.status === 'accepted' ? 'è®¢å•è¿›è¡Œä¸­' : orderDetail.status === 'completed' ? 'è®¢å•å·²å®Œæˆ' : 'è®¢å•å·²å–æ¶ˆ'}}</view>
      <view class="status-time">{{orderDetail.createdTime}}</view>
    </view>

    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="info-card">
      <view class="card-title">è®¢å•ä¿¡æ¯</view>
      
      <view class="info-row">
        <view class="info-label">è®¢å•æ ‡é¢˜</view>
        <view class="info-value">{{orderDetail.title}}</view>
      </view>
      
      <view class="info-row">
        <view class="info-label">æœåŠ¡ç±»å‹</view>
        <view class="info-value">{{orderDetail.typeText}}</view>
      </view>
      
      <view class="info-row">
        <view class="info-label">è®¢å•æè¿°</view>
        <view class="info-value">{{orderDetail.description}}</view>
      </view>
      
      <view class="info-row">
        <view class="info-label">å–è´§åœ°ç‚¹</view>
        <view class="info-value">{{orderDetail.pickup_location}}</view>
      </view>
      
      <view class="info-row">
        <view class="info-label">é€è´§åœ°ç‚¹</view>
        <view class="info-value">{{orderDetail.delivery_location}}</view>
      </view>
      
      <view class="info-row">
        <view class="info-label">è”ç³»ç”µè¯</view>
        <view class="info-value phone" bindtap="onCallPhone">
          {{orderDetail.contact_phone}}
          <text class="call-icon">ğŸ“</text>
        </view>
      </view>
      
      <view class="info-row price-row">
        <view class="info-label">è®¢å•é‡‘é¢</view>
        <view class="info-value price">Â¥{{orderDetail.price}}</view>
      </view>
    </view>

    <!-- è®¢å•å›¾ç‰‡ -->
    <view wx:if="{{orderDetail.images && orderDetail.images.length > 0}}" class="images-card">
      <view class="card-title">è®¢å•å›¾ç‰‡</view>
      <view class="images-grid">
        <image 
          wx:for="{{orderDetail.images}}" 
          wx:key="index"
          src="{{item}}" 
          class="order-image"
          mode="aspectFill"
          bindtap="onPreviewImage"
          data-url="{{item}}"
          data-index="{{index}}"
        />
      </view>
    </view>

    <!-- å‘å¸ƒè€…ä¿¡æ¯ -->
    <view class="user-card">
      <view class="card-title">å‘å¸ƒè€…</view>
      <view class="user-info">
        <view class="user-avatar {{!orderDetail.publisher_avatar ? 'avatar-placeholder' : ''}}">
          <image wx:if="{{orderDetail.publisher_avatar}}" src="{{orderDetail.publisher_avatar}}" mode="aspectFill" />
          <view wx:else class="avatar-icon">ğŸ‘¤</view>
        </view>
        <view class="user-detail">
          <view class="user-name">{{orderDetail.publisher_name || orderDetail.publisher_username || 'å‘å¸ƒç”¨æˆ·'}}</view>
          <view class="user-phone" wx:if="{{orderDetail.publisher_phone}}" bindtap="onContactPublisher">
            è”ç³»å‘å¸ƒè€… ğŸ“
          </view>
        </view>
      </view>
    </view>

    <!-- æ¥å•è€…ä¿¡æ¯ -->
    <view wx:if="{{orderDetail.acceptor_id}}" class="user-card">
      <view class="card-title">æ¥å•è€…</view>
      <view class="user-info">
        <view class="user-avatar {{!orderDetail.acceptor_avatar ? 'avatar-placeholder' : ''}}">
          <image wx:if="{{orderDetail.acceptor_avatar}}" src="{{orderDetail.acceptor_avatar}}" mode="aspectFill" />
          <view wx:else class="avatar-icon">ğŸ‘¤</view>
        </view>
        <view class="user-detail">
          <view class="user-name">{{orderDetail.acceptor_name || orderDetail.acceptor_username || 'æ¥å•ç”¨æˆ·'}}</view>
          <view class="user-phone" wx:if="{{orderDetail.acceptor_phone}}" bindtap="onContactAcceptor">
            è”ç³»æ¥å•è€… ğŸ“
          </view>
        </view>
      </view>
    </view>

    <!-- å–æ¶ˆè¯·æ±‚ä¿¡æ¯ -->
    <view wx:if="{{cancelRequest && cancelRequest.status === 'pending'}}" class="cancel-request-card">
      <view class="card-title">å–æ¶ˆè¯·æ±‚</view>
      <view class="cancel-request-content">
        <view class="cancel-request-info">
          <text class="cancel-request-icon">âš ï¸</text>
          <view class="cancel-request-text">
            <view class="cancel-request-title">
              {{isPublisher ? 'æ¥å•è€…è¯·æ±‚å–æ¶ˆè®¢å•' : 'æ‚¨å·²å‘èµ·å–æ¶ˆè¯·æ±‚'}}
            </view>
            <view class="cancel-request-reason">åŸå› ï¼š{{cancelRequest.reason}}</view>
          </view>
        </view>
        <view wx:if="{{isPublisher}}" class="cancel-request-actions">
          <button class="cancel-request-btn agree" bindtap="onHandleCancelRequest" data-action="agree">
            åŒæ„å–æ¶ˆ
          </button>
          <button class="cancel-request-btn reject" bindtap="onHandleCancelRequest" data-action="reject">
            æ‹’ç»
          </button>
        </view>
        <view wx:else class="cancel-request-waiting">
          ç­‰å¾…å‘å¸ƒè€…å¤„ç†...
        </view>
      </view>
    </view>

    <!-- æ—¶é—´ä¿¡æ¯ -->
    <view class="time-card">
      <view class="card-title">æ—¶é—´ä¿¡æ¯</view>
      <view class="time-item">
        <view class="time-label">åˆ›å»ºæ—¶é—´</view>
        <view class="time-value">{{orderDetail.createdTime}}</view>
      </view>
      <view wx:if="{{orderDetail.acceptedTime}}" class="time-item">
        <view class="time-label">æ¥å•æ—¶é—´</view>
        <view class="time-value">{{orderDetail.acceptedTime}}</view>
      </view>
      <view wx:if="{{orderDetail.completedTime}}" class="time-item">
        <view class="time-label">å®Œæˆæ—¶é—´</view>
        <view class="time-value">{{orderDetail.completedTime}}</view>
      </view>
      <view wx:if="{{orderDetail.cancelledTime}}" class="time-item">
        <view class="time-label">å–æ¶ˆæ—¶é—´</view>
        <view class="time-value">{{orderDetail.cancelledTime}}</view>
      </view>
      <view wx:if="{{orderDetail.cancel_reason}}" class="time-item">
        <view class="time-label">å–æ¶ˆåŸå› </view>
        <view class="time-value">{{orderDetail.cancel_reason}}</view>
      </view>
    </view>

  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view wx:if="{{orderDetail}}" class="bottom-actions">
    <button wx:if="{{canAccept}}" class="action-btn primary" bindtap="onAcceptOrder">
      æ¥å•
    </button>
    <button wx:if="{{canChat}}" class="action-btn chat" bindtap="onChat">
      ğŸ’¬ èŠå¤©åå•†
    </button>
    <button wx:if="{{canComplete}}" class="action-btn success" bindtap="onCompleteOrder">
      å®Œæˆè®¢å•
    </button>
    <button wx:if="{{canRequestCancel && !cancelRequest}}" class="action-btn warning" bindtap="onRequestCancel">
      è¯·æ±‚å–æ¶ˆ
    </button>
    <button wx:if="{{canCancel}}" class="action-btn cancel" bindtap="onCancelOrder">
      å–æ¶ˆè®¢å•
    </button>
    <button wx:if="{{!canAccept && !canComplete && !canCancel && !canRequestCancel && !canChat}}" class="action-btn" bindtap="onBack">
      è¿”å›
    </button>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{!orderDetail}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>
