# å–æ¶ˆåå•†åŠŸèƒ½ - å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿå¯åŠ¨

```bash
# 1. åˆ›å»ºæ•°æ®åº“è¡¨
node errand-back/create-cancel-requests-table.js

# 2. å¯åŠ¨åç«¯
cd errand-back
npm start

# 3. æµ‹è¯•åŠŸèƒ½
node test-cancel-request.js
```

## ğŸ“‹ åŠŸèƒ½é€ŸæŸ¥

### å–æ¶ˆè§„åˆ™

| è®¢å•çŠ¶æ€ | å‘å¸ƒè€… | æ¥å•è€… |
|---------|--------|--------|
| pending | âœ… ç›´æ¥å–æ¶ˆ | âœ… ç›´æ¥å–æ¶ˆ |
| accepted | âœ… ç›´æ¥å–æ¶ˆ | âš ï¸ éœ€è¦åå•† |

### æŒ‰é’®è¯´æ˜

| æŒ‰é’® | é¢œè‰² | æ¡ä»¶ |
|------|------|------|
| æ¥å• | è“è‰² | pending + éå‘å¸ƒè€… |
| ğŸ’¬ èŠå¤©åå•† | ç´«è‰² | accepted + åŒæ–¹ |
| å®Œæˆè®¢å• | ç»¿è‰² | accepted + æ¥å•è€… |
| è¯·æ±‚å–æ¶ˆ | é»„è‰² | accepted + æ¥å•è€… |
| å–æ¶ˆè®¢å• | çº¢è‰² | pending + åŒæ–¹ |

## ğŸ”Œ APIæ¥å£

```javascript
// åˆ›å»ºå–æ¶ˆè¯·æ±‚
POST /api/orders/:orderId/cancel-request
Body: { reason: string }

// è·å–å–æ¶ˆè¯·æ±‚
GET /api/orders/:orderId/cancel-request

// å¤„ç†å–æ¶ˆè¯·æ±‚
POST /api/orders/:orderId/cancel-request/handle
Body: { action: 'agree' | 'reject' }
```

## ğŸ’» ä»£ç ç¤ºä¾‹

### å‰ç«¯è°ƒç”¨

```javascript
const cancelRequestAPI = require('../../api/cancelRequest.js');

// å‘èµ·å–æ¶ˆè¯·æ±‚
await cancelRequestAPI.createCancelRequest(orderId, 'ä¸´æ—¶æœ‰äº‹');

// è·å–å–æ¶ˆè¯·æ±‚
const request = await cancelRequestAPI.getCancelRequest(orderId);

// åŒæ„å–æ¶ˆ
await cancelRequestAPI.handleCancelRequest(orderId, 'agree');

// æ‹’ç»å–æ¶ˆ
await cancelRequestAPI.handleCancelRequest(orderId, 'reject');
```

### åç«¯æ¨¡å‹

```javascript
const CancelRequest = require('../models/CancelRequest');

// åˆ›å»ºè¯·æ±‚
const id = await CancelRequest.create({
  order_id: orderId,
  requester_id: userId,
  reason: 'åŸå› '
});

// æŸ¥è¯¢è¯·æ±‚
const request = await CancelRequest.findByOrderId(orderId);

// åŒæ„è¯·æ±‚
await CancelRequest.agree(requestId);

// æ‹’ç»è¯·æ±‚
await CancelRequest.reject(requestId);
```

## ğŸ¨ æ ·å¼ç±»å

```css
.cancel-request-card        /* å–æ¶ˆè¯·æ±‚å¡ç‰‡ */
.cancel-request-info        /* è¯·æ±‚ä¿¡æ¯åŒºåŸŸ */
.cancel-request-actions     /* æ“ä½œæŒ‰é’®åŒºåŸŸ */
.cancel-request-btn.agree   /* åŒæ„æŒ‰é’® */
.cancel-request-btn.reject  /* æ‹’ç»æŒ‰é’® */
.action-btn.chat            /* èŠå¤©æŒ‰é’® */
.action-btn.warning         /* è¯·æ±‚å–æ¶ˆæŒ‰é’® */
```

## ğŸ“ å…³é”®æ–‡ä»¶

```
åç«¯ï¼š
- errand-back/src/models/CancelRequest.js
- errand-back/src/controllers/cancelRequest.controller.js
- errand-back/src/routes/cancelRequest.routes.js

å‰ç«¯ï¼š
- errand-front/api/cancelRequest.js
- errand-front/pages/order/detail.js
- errand-front/pages/order/detail.wxml
- errand-front/pages/order/detail.wxss

æ•°æ®åº“ï¼š
- errand-back/create-cancel-requests-table.js
```

## ğŸ› å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°"è¯·æ±‚å–æ¶ˆ"æŒ‰é’®ï¼Ÿ**
A: æ£€æŸ¥è®¢å•çŠ¶æ€æ˜¯å¦ä¸ºacceptedï¼Œä¸”å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºæ¥å•è€…

**Q: ä¸ºä»€ä¹ˆæ— æ³•å‘èµ·å–æ¶ˆè¯·æ±‚ï¼Ÿ**
A: æ£€æŸ¥æ˜¯å¦å·²æœ‰å¾…å¤„ç†çš„å–æ¶ˆè¯·æ±‚

**Q: èŠå¤©æŒ‰é’®ä¸æ˜¾ç¤ºï¼Ÿ**
A: ç¡®ä¿è®¢å•çŠ¶æ€ä¸ºacceptedï¼Œä¸”å½“å‰ç”¨æˆ·æ˜¯å‘å¸ƒè€…æˆ–æ¥å•è€…

**Q: æ•°æ®åº“è¡¨åˆ›å»ºå¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥.envæ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®

## ğŸ“ è·å–å¸®åŠ©

- [å®Œæ•´æ–‡æ¡£](CANCEL-REQUEST-FEATURE.md)
- [ä½¿ç”¨è¯´æ˜](å–æ¶ˆåå•†åŠŸèƒ½ä½¿ç”¨è¯´æ˜.md)
- [å®ç°æ€»ç»“](CANCEL-NEGOTIATION-COMPLETE.md)
