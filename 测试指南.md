# 校园跑腿平台 - 测试指南

## 数据库数据说明

已成功添加15条测试订单数据到MySQL数据库：

### 订单类型分布
- **快递代取** (type=1): 5条订单
- **外卖配送** (type=2): 5条订单  
- **代购服务** (type=3): 3条订单
- **其他服务** (type=4): 2条订单

### 订单状态分布
- **待接单** (pending): 6条
- **进行中** (accepted): 3条
- **已完成** (completed): 4条
- **已取消** (cancelled): 2条

### 测试用户
所有用户密码都是: `admin123`

| 用户名 | 邮箱 | 角色 | 昵称 |
|--------|------|------|------|
| admin | admin@example.com | admin | Admin User |
| teacher1 | teacher1@example.com | teacher | Teacher Zhang |
| student1 | student1@example.com | student | Student Ming |
| student2 | student2@example.com | student | Student Hong |
| student3 | student3@example.com | student | Student Gang |
| student4 | student4@example.com | student | Student Li |

## 前后端配置检查清单

### ✅ 后端配置
- [x] 数据库连接正常 (localhost:3306)
- [x] 服务器运行在 http://localhost:3000
- [x] API响应格式统一: `{success, code, data, message}`
- [x] JWT认证正常工作
- [x] 订单数据已插入数据库

### ✅ 前端配置
- [x] baseUrl设置为 `http://localhost:3000/api`
- [x] 自动登录使用 student1@example.com
- [x] 订单类型映射匹配后端 (1-4)
- [x] 订单状态映射匹配后端 (pending/accepted/completed/cancelled)

## 在微信开发者工具中测试

### 1. 配置开发者工具

1. 打开微信开发者工具
2. 导入项目，选择 `errand-front` 目录
3. 进入 **详情 > 本地设置**
4. ✅ 勾选 "不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
5. ✅ 勾选 "不校验安全域名、TLS 版本以及 HTTPS 证书"

### 2. 启动后端服务器

```bash
cd errand-back
npm run dev
# 或
start-dev.bat
```

确保看到：
```
服务器运行在端口 3000
环境: development
MySQL 连接成功: localhost
```

### 3. 测试步骤

#### 首页订单列表
1. 打开小程序，会自动登录（student1@example.com）
2. 首页应该显示订单列表
3. 可以看到不同类型的订单（快递、外卖、代购、其他）
4. 订单显示状态标签（待接单、进行中、已完成、已取消）

#### 筛选功能
1. 点击顶部的服务类型图标进行筛选
2. 使用搜索框搜索订单

#### 订单详情
1. 点击任意订单查看详情
2. 查看订单的完整信息

#### 接单功能
1. 对于"待接单"状态的订单
2. 点击"接单"按钮
3. 确认后订单状态变为"进行中"

### 4. API测试

使用PowerShell测试API：

```powershell
# 登录获取token
$response = Invoke-RestMethod -Uri "http://localhost:3000/api/auth/login" -Method POST -ContentType "application/json" -Body '{"email":"student1@example.com","password":"admin123"}'
$token = $response.token

# 获取订单列表
Invoke-RestMethod -Uri "http://localhost:3000/api/orders?page=1&pageSize=10" -Method GET -Headers @{"Authorization"="Bearer $token"}

# 获取订单详情
Invoke-RestMethod -Uri "http://localhost:3000/api/orders/1" -Method GET -Headers @{"Authorization"="Bearer $token"}
```

## 常见问题

### 问题1: 小程序显示"加载失败"
**解决方案:**
1. 检查后端服务器是否运行
2. 检查微信开发者工具是否勾选"不校验合法域名"
3. 查看控制台错误信息

### 问题2: 订单列表为空
**解决方案:**
1. 确认数据库中有数据: `SELECT COUNT(*) FROM orders;`
2. 检查API返回: 在Network标签查看请求响应
3. 查看后端日志是否有错误

### 问题3: 登录失败
**解决方案:**
1. 确认用户存在: `SELECT * FROM users WHERE email='student1@example.com';`
2. 检查密码是否正确: admin123
3. 查看后端日志

### 问题4: 图片显示问题
**解决方案:**
- 当前测试数据中images字段为空数组 `[]`
- 如需测试图片，可以手动更新数据库中的images字段

## 数据库操作

### 查看所有订单
```sql
USE errand_platform;
SELECT 
  o.id,
  o.title,
  o.type,
  o.status,
  o.price,
  u.nickname as publisher,
  a.nickname as acceptor
FROM orders o
LEFT JOIN users u ON o.user_id = u.id
LEFT JOIN users a ON o.acceptor_id = a.id
ORDER BY o.created_at DESC;
```

### 重置订单数据
```sql
USE errand_platform;
DELETE FROM orders;
-- 然后重新运行 insert-orders.sql
```

### 添加更多测试数据
可以修改 `errand-back/database/insert-orders.sql` 文件，然后执行：
```bash
Get-Content database/insert-orders.sql | mysql -u root -p123456
```

## 下一步

1. ✅ 测试订单列表显示
2. ✅ 测试订单筛选功能
3. ✅ 测试订单详情页面
4. ✅ 测试接单功能
5. 测试发布订单功能
6. 测试用户个人中心
7. 添加更多测试数据
8. 测试图片上传功能

## 技术支持

如遇到问题，请检查：
1. 后端日志 (控制台输出)
2. 前端控制台 (微信开发者工具 Console)
3. Network请求 (微信开发者工具 Network)
4. 数据库数据 (MySQL查询)
