# æ¸…ç†æµ‹è¯•æ•°æ®è¯´æ˜

## æ¸…ç†è„šæœ¬

æˆ‘åˆ›å»ºäº†ä¸¤ä¸ªæ¸…ç†è„šæœ¬ï¼Œä½äº `errand-back` ç›®å½•ï¼š

### 1. clean-test-orders.jsï¼ˆæ¨èï¼‰
**åŠŸèƒ½ï¼š** åªåˆ é™¤è®¢å•ç›¸å…³æ•°æ®ï¼Œä¿ç•™ç”¨æˆ·è´¦å·

**åˆ é™¤å†…å®¹ï¼š**
- âœ… æ‰€æœ‰è®¢å•
- âœ… æ‰€æœ‰æ¶ˆæ¯
- âœ… æ‰€æœ‰å–æ¶ˆè¯·æ±‚

**ä¿ç•™å†…å®¹ï¼š**
- âœ… ç”¨æˆ·è´¦å·ï¼ˆå¯ä»¥ç»§ç»­ä½¿ç”¨ï¼‰
- âœ… ç”¨æˆ·é’±åŒ…æ•°æ®

### 2. clean-test-data.jsï¼ˆå®Œå…¨æ¸…ç†ï¼‰
**åŠŸèƒ½ï¼š** åˆ é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®ï¼ŒåŒ…æ‹¬æµ‹è¯•ç”¨æˆ·

**åˆ é™¤å†…å®¹ï¼š**
- âœ… æ‰€æœ‰è®¢å•
- âœ… æ‰€æœ‰æ¶ˆæ¯
- âœ… æ‰€æœ‰å–æ¶ˆè¯·æ±‚
- âœ… æµ‹è¯•ç”¨æˆ·ï¼ˆusernameåŒ…å«testæˆ–userçš„ç”¨æˆ·ï¼‰

## ä½¿ç”¨æ–¹æ³•

### æ­¥éª¤1ï¼šæŸ¥çœ‹æ•°æ®
é¦–å…ˆè¿è¡Œè„šæœ¬æŸ¥çœ‹å½“å‰æ•°æ®ï¼ˆä¸ä¼šåˆ é™¤ï¼‰ï¼š

```bash
cd errand-back
node clean-test-orders.js
```

è„šæœ¬ä¼šæ˜¾ç¤ºï¼š
- å½“å‰æ•°æ®ç»Ÿè®¡
- æ‰€æœ‰è®¢å•è¯¦æƒ…
- æ¯ä¸ªè®¢å•çš„æ¶ˆæ¯æ•°å’Œå–æ¶ˆè¯·æ±‚æ•°

### æ­¥éª¤2ï¼šç¡®è®¤åˆ é™¤
å¦‚æœç¡®è®¤è¦åˆ é™¤ï¼Œç¼–è¾‘è„šæœ¬æ–‡ä»¶ï¼š

**Windows:**
```bash
notepad clean-test-orders.js
```

**æ‰¾åˆ°è¿™ä¸€è¡Œï¼š**
```javascript
const CONFIRM_DELETE = false;
```

**æ”¹ä¸ºï¼š**
```javascript
const CONFIRM_DELETE = true;
```

ä¿å­˜æ–‡ä»¶ã€‚

### æ­¥éª¤3ï¼šæ‰§è¡Œåˆ é™¤
å†æ¬¡è¿è¡Œè„šæœ¬ï¼š

```bash
node clean-test-orders.js
```

è¿™æ¬¡ä¼šçœŸæ­£æ‰§è¡Œåˆ é™¤æ“ä½œã€‚

### æ­¥éª¤4ï¼šæ¢å¤å®‰å…¨å¼€å…³ï¼ˆå¯é€‰ï¼‰
åˆ é™¤å®Œæˆåï¼Œå»ºè®®å°† `CONFIRM_DELETE` æ”¹å› `false`ï¼Œé˜²æ­¢è¯¯æ“ä½œã€‚

## å®‰å…¨æœºåˆ¶

ä¸¤ä¸ªè„šæœ¬éƒ½æœ‰å®‰å…¨ä¿æŠ¤ï¼š
- é»˜è®¤ `CONFIRM_DELETE = false`ï¼Œä¸ä¼šåˆ é™¤æ•°æ®
- åªä¼šæ˜¾ç¤ºæ•°æ®ç»Ÿè®¡å’Œè¯¦æƒ…
- å¿…é¡»æ‰‹åŠ¨ä¿®æ”¹ä»£ç æ‰èƒ½æ‰§è¡Œåˆ é™¤
- é˜²æ­¢è¯¯æ“ä½œå¯¼è‡´æ•°æ®ä¸¢å¤±

## åˆ é™¤é¡ºåº

è„šæœ¬æŒ‰ç…§æ•°æ®åº“å¤–é”®ä¾èµ–å…³ç³»åˆ é™¤ï¼š
1. å–æ¶ˆè¯·æ±‚ï¼ˆä¾èµ–è®¢å•ï¼‰
2. æ¶ˆæ¯ï¼ˆä¾èµ–è®¢å•ï¼‰
3. è®¢å•ï¼ˆä¸»è¡¨ï¼‰
4. ç”¨æˆ·ï¼ˆä»… clean-test-data.jsï¼‰

## ç¤ºä¾‹è¾“å‡º

### æŸ¥çœ‹æ•°æ®æ—¶ï¼š
```
ğŸ§¹ å¼€å§‹æ¸…ç†æµ‹è¯•è®¢å•...

ğŸ“Š å½“å‰æ•°æ®ç»Ÿè®¡:
  è®¢å•æ€»æ•°: 5
  æ¶ˆæ¯æ€»æ•°: 12
  å–æ¶ˆè¯·æ±‚æ€»æ•°: 2

ğŸ“¦ æ‰€æœ‰è®¢å•åˆ—è¡¨:

  è®¢å• #1:
    æ ‡é¢˜: å¸®æˆ‘å–å¿«é€’
    çŠ¶æ€: accepted
    ä»·æ ¼: Â¥5
    å‘å¸ƒè€…: testuser1 (æµ‹è¯•ç”¨æˆ·1)
    æ¥å•è€…: testuser2 (æµ‹è¯•ç”¨æˆ·2)
    åˆ›å»ºæ—¶é—´: 2024-01-15 10:30:00
    æ¶ˆæ¯æ•°: 5
    å–æ¶ˆè¯·æ±‚: 0

âš ï¸  è­¦å‘Š: å³å°†åˆ é™¤ä»¥ä¸‹æ•°æ®:
  - 5 ä¸ªè®¢å•
  - 12 æ¡æ¶ˆæ¯
  - 2 ä¸ªå–æ¶ˆè¯·æ±‚

  æ³¨æ„: ç”¨æˆ·æ•°æ®å°†è¢«ä¿ç•™

âŒ åˆ é™¤æœªæ‰§è¡Œï¼ˆå®‰å…¨ä¿æŠ¤ï¼‰
   å¦‚éœ€åˆ é™¤ï¼Œè¯·ç¼–è¾‘æ­¤æ–‡ä»¶ï¼Œå°† CONFIRM_DELETE è®¾ç½®ä¸º true
```

### æ‰§è¡Œåˆ é™¤åï¼š
```
ğŸ—‘ï¸  å¼€å§‹åˆ é™¤æ•°æ®...

âœ… åˆ é™¤å–æ¶ˆè¯·æ±‚: 2 æ¡
âœ… åˆ é™¤æ¶ˆæ¯: 12 æ¡
âœ… åˆ é™¤è®¢å•: 5 æ¡

ğŸ“Š æ¸…ç†åæ•°æ®ç»Ÿè®¡:
  è®¢å•æ•°: 0
  æ¶ˆæ¯æ•°: 0
  å–æ¶ˆè¯·æ±‚æ•°: 0
  ç”¨æˆ·æ•°: 3 (ä¿ç•™)

âœ… æµ‹è¯•è®¢å•æ¸…ç†å®Œæˆï¼
ğŸ’¡ ç”¨æˆ·æ•°æ®å·²ä¿ç•™ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ç°æœ‰è´¦å·
```

## æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½æ•°æ®åº“**ï¼šåˆ é™¤å‰å»ºè®®å¤‡ä»½æ•°æ®åº“
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¿™äº›è„šæœ¬
3. **ç”¨æˆ·é€‰æ‹©**ï¼š
   - å¦‚æœæƒ³ä¿ç•™ç”¨æˆ·è´¦å·ï¼Œä½¿ç”¨ `clean-test-orders.js`
   - å¦‚æœæƒ³å®Œå…¨æ¸…ç†ï¼Œä½¿ç”¨ `clean-test-data.js`
4. **ä¸å¯æ¢å¤**ï¼šåˆ é™¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œ

## æ•°æ®åº“å¤‡ä»½

åˆ é™¤å‰å»ºè®®å¤‡ä»½æ•°æ®åº“ï¼š

```bash
# å¤‡ä»½æ•´ä¸ªæ•°æ®åº“
mysqldump -u root -p errand_platform > backup_$(date +%Y%m%d_%H%M%S).sql

# åªå¤‡ä»½è®¢å•ç›¸å…³è¡¨
mysqldump -u root -p errand_platform orders messages cancel_requests > backup_orders_$(date +%Y%m%d_%H%M%S).sql
```

## æ¢å¤æ•°æ®

å¦‚æœéœ€è¦æ¢å¤å¤‡ä»½ï¼š

```bash
mysql -u root -p errand_platform < backup_20240115_103000.sql
```

## å¸¸è§é—®é¢˜

### Q: åˆ é™¤åç”¨æˆ·è¿˜èƒ½ç™»å½•å—ï¼Ÿ
A: ä½¿ç”¨ `clean-test-orders.js` åˆ é™¤åï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•ï¼Œåªæ˜¯æ²¡æœ‰è®¢å•æ•°æ®ã€‚

### Q: åˆ é™¤åèƒ½æ¢å¤å—ï¼Ÿ
A: ä¸èƒ½ï¼Œé™¤éä½ æå‰å¤‡ä»½äº†æ•°æ®åº“ã€‚

### Q: ä¸ºä»€ä¹ˆè¦æ‰‹åŠ¨ä¿®æ”¹ä»£ç ï¼Ÿ
A: è¿™æ˜¯å®‰å…¨æœºåˆ¶ï¼Œé˜²æ­¢è¯¯æ“ä½œã€‚ç¡®ä¿ä½ çœŸçš„æƒ³åˆ é™¤æ•°æ®ã€‚

### Q: å¯ä»¥åªåˆ é™¤æŸäº›è®¢å•å—ï¼Ÿ
A: å½“å‰è„šæœ¬ä¼šåˆ é™¤æ‰€æœ‰è®¢å•ã€‚å¦‚éœ€é€‰æ‹©æ€§åˆ é™¤ï¼Œè¯·ä¿®æ”¹SQLè¯­å¥æ·»åŠ WHEREæ¡ä»¶ã€‚

## é€‰æ‹©æ€§åˆ é™¤ç¤ºä¾‹

å¦‚æœåªæƒ³åˆ é™¤ç‰¹å®šè®¢å•ï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬ä¸­çš„SQLï¼š

```javascript
// åªåˆ é™¤çŠ¶æ€ä¸ºcancelledçš„è®¢å•
await db.execute('DELETE FROM cancel_requests WHERE order_id IN (SELECT id FROM orders WHERE status = "cancelled")');
await db.execute('DELETE FROM messages WHERE order_id IN (SELECT id FROM orders WHERE status = "cancelled")');
await db.execute('DELETE FROM orders WHERE status = "cancelled"');

// åªåˆ é™¤æŸä¸ªç”¨æˆ·çš„è®¢å•
await db.execute('DELETE FROM cancel_requests WHERE order_id IN (SELECT id FROM orders WHERE user_id = 1)');
await db.execute('DELETE FROM messages WHERE order_id IN (SELECT id FROM orders WHERE user_id = 1)');
await db.execute('DELETE FROM orders WHERE user_id = 1');
```
