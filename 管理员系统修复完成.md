# 管理员系统修复完成

## 问题描述
管理员系统的三个主要API返回500错误：
- `/api/admin/users` - 用户列表
- `/api/admin/orders` - 订单列表  
- `/api/admin/certifications` - 认证列表

## 问题原因

### 1. SQL字段名错误
订单列表查询使用了错误的字段名：
- 错误：`publisher_id`, `receiver_id`
- 正确：`user_id`, `acceptor_id`

### 2. SQL参数化查询问题
MySQL的prepared statement在某些情况下不支持LIMIT和OFFSET使用参数占位符，导致`Incorrect arguments to mysqld_stmt_execute`错误。

### 3. 空字符串参数处理
前端传递的空字符串参数（如`keyword=''`, `status=''`）没有正确过滤，导致SQL参数数量不匹配。

## 修复方案

### 1. 修正订单表字段名
```javascript
// 修改前
LEFT JOIN users u1 ON o.publisher_id = u1.id
LEFT JOIN users u2 ON o.receiver_id = u2.id

// 修改后
LEFT JOIN users u1 ON o.user_id = u1.id
LEFT JOIN users u2 ON o.acceptor_id = u2.id
```

### 2. 使用字符串拼接LIMIT/OFFSET
```javascript
// 修改前
LIMIT ? OFFSET ?
[...params, pageSizeNum, offset]

// 修改后
LIMIT ${pageSizeNum} OFFSET ${offset}
params  // 不包含LIMIT/OFFSET参数
```

### 3. 增强参数验证
```javascript
// 添加trim()和空字符串检查
if (keyword && keyword.trim() !== '') {
  // 添加到查询条件
}

if (status && status.trim() !== '') {
  // 添加到查询条件
}
```

## 测试结果

所有API测试通过：
```
✓ 登录成功
✓ 用户列表获取成功 (43个用户)
✓ 订单列表获取成功 (11个订单)
✓ 认证列表获取成功 (1个认证)
```

## 使用说明

1. 启动后端服务器：
```bash
cd errand-back
node server.js
```

2. 打开管理员系统：
```
errand-admin/index.html
```

3. 使用管理员账号登录：
- 用户名：admin
- 密码：admin123

4. 现在可以正常访问：
- 用户管理
- 订单管理
- 认证管理

## 修改的文件
- `errand-back/src/controllers/admin.controller.js` - 修复三个列表API

## 注意事项
- 服务器必须运行在3000端口
- 确保MySQL数据库连接正常
- 管理员token有效期为24小时
