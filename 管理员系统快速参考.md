# 管理员系统快速参考

## 🚀 快速启动

### 初始化（仅首次）
```bash
cd errand-back
node create-admin-table.js
```

### 启动后端
```bash
cd errand-back
npm start
```

### 访问管理后台
打开浏览器访问：`errand-admin/index.html`

### 默认账号
- 用户名：`admin`
- 密码：`admin123`

---

## 📋 主要功能

### 1️⃣ 数据统计
- 总用户数、已认证用户、今日新增
- 总订单数、待处理、已完成
- 待审核认证、已通过、已拒绝

### 2️⃣ 用户管理
- ✅ 查看所有用户
- ✅ 搜索用户（用户名/昵称/手机/学号）
- ✅ 筛选认证状态
- ✅ 查看用户详情
- ✅ 编辑用户信息
- ✅ 删除用户（超级管理员）

### 3️⃣ 订单管理
- ✅ 查看所有订单
- ✅ 搜索订单（标题/描述）
- ✅ 筛选订单状态
- ✅ 查看订单详情
- ✅ 编辑订单信息
- ✅ 删除订单（超级管理员）

### 4️⃣ 认证审核
- ✅ 查看所有认证申请
- ✅ 筛选认证状态
- ✅ 查看认证详情和证件照片
- ✅ 审核通过/拒绝
- ✅ 填写拒绝原因

---

## 🔑 权限说明

| 角色 | 权限 |
|------|------|
| **super_admin** | 所有权限，包括删除用户/订单、管理其他管理员 |
| **admin** | 查看、编辑、审核，不能删除 |
| **moderator** | 仅查看和审核认证 |

---

## 🔧 API 端点

### 认证
```
POST   /api/admin/login              # 登录
GET    /api/admin/me                 # 获取当前管理员信息
```

### 统计
```
GET    /api/admin/statistics         # 获取系统统计数据
```

### 用户
```
GET    /api/admin/users              # 获取用户列表
GET    /api/admin/users/:id          # 获取用户详情
PUT    /api/admin/users/:id          # 更新用户信息
DELETE /api/admin/users/:id          # 删除用户
```

### 订单
```
GET    /api/admin/orders             # 获取订单列表
GET    /api/admin/orders/:id         # 获取订单详情
PUT    /api/admin/orders/:id         # 更新订单
DELETE /api/admin/orders/:id         # 删除订单
```

### 认证
```
GET    /api/admin/certifications     # 获取认证列表
POST   /api/admin/certifications/:id/review  # 审核认证
```

---

## 📝 常用操作

### 审核认证申请
1. 点击"认证审核"菜单
2. 点击"查看详情"查看证件照片
3. 点击"通过"或"拒绝"
4. 拒绝时需填写原因

### 搜索用户
1. 点击"用户管理"菜单
2. 在搜索框输入关键词
3. 选择认证状态筛选
4. 点击"搜索"

### 管理订单
1. 点击"订单管理"菜单
2. 可按状态筛选
3. 点击"查看"查看详情
4. 点击"删除"删除订单（需超级管理员权限）

---

## ⚠️ 注意事项

1. **首次登录后立即修改默认密码**
2. **不要将管理后台暴露在公网**
3. **重要操作前先备份数据库**
4. **定期检查管理员操作日志**
5. **Token 有效期 24 小时，过期需重新登录**

---

## 🐛 故障排查

### 登录失败
- ✓ 检查后端服务是否运行
- ✓ 检查数据库连接
- ✓ 确认用户名密码正确

### Token 过期
- ✓ 重新登录获取新 Token

### 图片无法显示
- ✓ 检查 uploads 目录权限
- ✓ 确认静态文件服务正常

### 权限不足
- ✓ 确认当前账号角色
- ✓ 联系超级管理员分配权限

---

## 📞 技术支持

详细文档：`管理员系统使用说明.md`

---

## 📦 文件结构

```
errand-back/
├── create-admin-table.js          # 数据库初始化脚本
├── setup-admin.bat                # Windows 快速启动脚本
├── src/
│   ├── models/Admin.js            # 管理员模型
│   ├── controllers/admin.controller.js  # 管理员控制器
│   ├── middleware/adminAuth.js    # 管理员认证中间件
│   └── routes/admin.routes.js     # 管理员路由

errand-admin/
├── index.html                     # 管理后台页面
├── admin.js                       # 管理后台脚本
└── README.md                      # 快速开始文档
```

---

## 🎯 下一步

1. ✅ 运行初始化脚本
2. ✅ 启动后端服务
3. ✅ 访问管理后台
4. ✅ 使用默认账号登录
5. ⚠️ **修改默认密码**
6. ✅ 开始管理平台数据

---

**祝使用愉快！** 🎉
