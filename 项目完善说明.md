# é¡¹ç›®å®Œå–„è¯´æ˜

## ğŸ¯ æœ¬æ¬¡å®Œå–„å†…å®¹

### 1. æ·»åŠ é€šçŸ¥ç³»ç»Ÿ

#### åç«¯å®ç°
- âœ… **é€šçŸ¥æ¨¡å‹** (`Notification.js`)
  - åˆ›å»ºé€šçŸ¥
  - è·å–é€šçŸ¥åˆ—è¡¨
  - æ ‡è®°å·²è¯»/å…¨éƒ¨å·²è¯»
  - è·å–æœªè¯»æ•°é‡
  - åˆ é™¤é€šçŸ¥

- âœ… **é€šçŸ¥æ§åˆ¶å™¨** (`notification.controller.js`)
  - `getNotifications` - è·å–é€šçŸ¥åˆ—è¡¨
  - `markAsRead` - æ ‡è®°å•ä¸ªé€šçŸ¥å·²è¯»
  - `markAllAsRead` - æ ‡è®°æ‰€æœ‰é€šçŸ¥å·²è¯»
  - `getUnreadCount` - è·å–æœªè¯»æ•°é‡
  - `deleteNotification` - åˆ é™¤é€šçŸ¥

- âœ… **é€šçŸ¥è·¯ç”±** (`notification.routes.js`)
  - `GET /api/notifications` - é€šçŸ¥åˆ—è¡¨
  - `GET /api/notifications/unread-count` - æœªè¯»æ•°é‡
  - `PUT /api/notifications/:id/read` - æ ‡è®°å·²è¯»
  - `PUT /api/notifications/read-all` - å…¨éƒ¨å·²è¯»
  - `DELETE /api/notifications/:id` - åˆ é™¤é€šçŸ¥

- âœ… **æ•°æ®åº“è¡¨** (`notifications`)
  - å­˜å‚¨ç”¨æˆ·é€šçŸ¥
  - å…³è”è®¢å•
  - å·²è¯»çŠ¶æ€
  - é€šçŸ¥ç±»å‹

#### å‰ç«¯å®ç°
- âœ… **é€šçŸ¥API** (`api/notification.js`)
  - å®Œæ•´çš„é€šçŸ¥æ¥å£å°è£…

- âœ… **é€šçŸ¥é¡µé¢** (`pages/notification/`)
  - é€šçŸ¥åˆ—è¡¨å±•ç¤º
  - æœªè¯»æ ‡è®°
  - ç‚¹å‡»è·³è½¬è®¢å•è¯¦æƒ…
  - åˆ é™¤é€šçŸ¥
  - å…¨éƒ¨å·²è¯»
  - ä¸‹æ‹‰åˆ·æ–°
  - ä¸Šæ‹‰åŠ è½½æ›´å¤š

- âœ… **ç”¨æˆ·ä¸­å¿ƒé›†æˆ**
  - æ˜¾ç¤ºæœªè¯»é€šçŸ¥æ•°é‡
  - é€šçŸ¥å…¥å£

### 2. è®¢å•çŠ¶æ€å˜æ›´è‡ªåŠ¨é€šçŸ¥

#### è‡ªåŠ¨é€šçŸ¥è§¦å‘
- âœ… **æ¥å•æ—¶** - é€šçŸ¥è®¢å•å‘å¸ƒè€…
- âœ… **å®Œæˆè®¢å•æ—¶** - é€šçŸ¥è®¢å•å‘å¸ƒè€…
- âœ… **å–æ¶ˆè®¢å•æ—¶** - é€šçŸ¥ç›¸å…³æ–¹ï¼ˆå‘å¸ƒè€…æˆ–æ¥å•è€…ï¼‰

#### é€šçŸ¥ç±»å‹
- `order_accepted` - è®¢å•å·²è¢«æ¥å•
- `order_completed` - è®¢å•å·²å®Œæˆ
- `order_cancelled` - è®¢å•å·²å–æ¶ˆ

### 3. å®æ—¶æ•°æ®åŒæ­¥

#### å‰ç«¯æ“ä½œ â†’ åç«¯æ•°æ®å˜æ›´
```
ç”¨æˆ·æ¥å•
  â†“
åç«¯æ›´æ–°è®¢å•çŠ¶æ€
  â†“
åˆ›å»ºé€šçŸ¥ç»™å‘å¸ƒè€…
  â†“
å‘å¸ƒè€…æ”¶åˆ°é€šçŸ¥
  â†“
ç‚¹å‡»é€šçŸ¥æŸ¥çœ‹è®¢å•è¯¦æƒ…
```

#### æ•°æ®æµ
```
å‰ç«¯æ“ä½œ â†’ APIè¯·æ±‚ â†’ åç«¯å¤„ç† â†’ æ•°æ®åº“æ›´æ–° â†’ åˆ›å»ºé€šçŸ¥ â†’ å‰ç«¯åˆ·æ–°
```

## ğŸ“Š æ–°å¢æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
1. `errand-back/src/models/Notification.js` - é€šçŸ¥æ¨¡å‹
2. `errand-back/src/controllers/notification.controller.js` - é€šçŸ¥æ§åˆ¶å™¨
3. `errand-back/src/routes/notification.routes.js` - é€šçŸ¥è·¯ç”±
4. `errand-back/database/add-notifications-table.sql` - é€šçŸ¥è¡¨SQL

### å‰ç«¯æ–‡ä»¶
1. `errand-front/api/notification.js` - é€šçŸ¥API
2. `errand-front/pages/notification/notification.js` - é€šçŸ¥é¡µé¢é€»è¾‘
3. `errand-front/pages/notification/notification.json` - é€šçŸ¥é¡µé¢é…ç½®
4. `errand-front/pages/notification/notification.wxml` - é€šçŸ¥é¡µé¢æ¨¡æ¿
5. `errand-front/pages/notification/notification.wxss` - é€šçŸ¥é¡µé¢æ ·å¼

### æ–‡æ¡£æ–‡ä»¶
1. `é¡¹ç›®å®Œå–„è¯´æ˜.md` - æœ¬æ–‡æ¡£

**æ€»è®¡ï¼š11ä¸ªæ–°æ–‡ä»¶**

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯
1. `errand-back/src/app.js` - æ·»åŠ é€šçŸ¥è·¯ç”±
2. `errand-back/src/controllers/order.controller.js` - æ·»åŠ é€šçŸ¥åˆ›å»ºé€»è¾‘
3. `errand-back/database/schema.sql` - æ·»åŠ é€šçŸ¥è¡¨å®šä¹‰

### å‰ç«¯
1. `errand-front/pages/user/user.js` - æ·»åŠ æœªè¯»é€šçŸ¥æ•°é‡æ˜¾ç¤º
2. `errand-front/app.json` - æ³¨å†Œé€šçŸ¥é¡µé¢

**æ€»è®¡ï¼š5ä¸ªä¿®æ”¹æ–‡ä»¶**

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æ›´æ–°æ•°æ®åº“

```bash
cd errand-back
mysql -u root -p < database/add-notifications-table.sql
```

æˆ–è€…å¦‚æœæ•°æ®åº“å·²å­˜åœ¨ï¼Œç›´æ¥è¿è¡Œï¼š
```sql
USE errand_platform;
SOURCE database/add-notifications-table.sql;
```

### 2. é‡å¯åç«¯æœåŠ¡

```bash
cd errand-back
npm run dev
```

### 3. æµ‹è¯•é€šçŸ¥åŠŸèƒ½

#### æµ‹è¯•æ­¥éª¤ï¼š
1. ç™»å½•å°ç¨‹åº
2. åœ¨é¦–é¡µæ¥ä¸€ä¸ªè®¢å•
3. åˆ‡æ¢åˆ°"æˆ‘çš„"æ ‡ç­¾
4. æŸ¥çœ‹æœªè¯»é€šçŸ¥æ•°é‡ï¼ˆåº”è¯¥æ˜¾ç¤ºçº¢ç‚¹ï¼‰
5. ç‚¹å‡»"æ¶ˆæ¯é€šçŸ¥"è¿›å…¥é€šçŸ¥é¡µé¢
6. æŸ¥çœ‹é€šçŸ¥åˆ—è¡¨
7. ç‚¹å‡»é€šçŸ¥è·³è½¬åˆ°è®¢å•è¯¦æƒ…
8. æ ‡è®°å·²è¯»æˆ–åˆ é™¤é€šçŸ¥

## ğŸ“‹ APIæ¥å£è¯´æ˜

### é€šçŸ¥æ¥å£

#### 1. è·å–é€šçŸ¥åˆ—è¡¨
```
GET /api/notifications?page=1&pageSize=20&unreadOnly=false
Authorization: Bearer {token}

å“åº”ï¼š
{
  "success": true,
  "code": 0,
  "data": [
    {
      "id": 1,
      "user_id": 3,
      "order_id": 7,
      "type": "order_accepted",
      "title": "è®¢å•å·²è¢«æ¥å•",
      "content": "æ‚¨çš„è®¢å•\"Buy breakfast\"å·²è¢«æ¥å•",
      "is_read": false,
      "created_at": "2024-01-01T10:00:00.000Z",
      "order_title": "Buy breakfast"
    }
  ],
  "message": "è·å–é€šçŸ¥åˆ—è¡¨æˆåŠŸ"
}
```

#### 2. è·å–æœªè¯»æ•°é‡
```
GET /api/notifications/unread-count
Authorization: Bearer {token}

å“åº”ï¼š
{
  "success": true,
  "code": 0,
  "data": {
    "count": 3
  },
  "message": "è·å–æœªè¯»æ•°é‡æˆåŠŸ"
}
```

#### 3. æ ‡è®°å·²è¯»
```
PUT /api/notifications/:id/read
Authorization: Bearer {token}

å“åº”ï¼š
{
  "success": true,
  "code": 0,
  "message": "æ ‡è®°æˆåŠŸ"
}
```

#### 4. å…¨éƒ¨å·²è¯»
```
PUT /api/notifications/read-all
Authorization: Bearer {token}

å“åº”ï¼š
{
  "success": true,
  "code": 0,
  "message": "å…¨éƒ¨æ ‡è®°æˆåŠŸ"
}
```

#### 5. åˆ é™¤é€šçŸ¥
```
DELETE /api/notifications/:id
Authorization: Bearer {token}

å“åº”ï¼š
{
  "success": true,
  "code": 0,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### 1. å®æ—¶é€šçŸ¥
- âœ… è®¢å•çŠ¶æ€å˜æ›´è‡ªåŠ¨åˆ›å»ºé€šçŸ¥
- âœ… æœªè¯»é€šçŸ¥æ•°é‡å®æ—¶æ˜¾ç¤º
- âœ… é€šçŸ¥åˆ—è¡¨å®æ—¶æ›´æ–°

### 2. ç”¨æˆ·ä½“éªŒ
- âœ… æœªè¯»é€šçŸ¥çº¢ç‚¹æç¤º
- âœ… ç‚¹å‡»é€šçŸ¥è·³è½¬è®¢å•è¯¦æƒ…
- âœ… è‡ªåŠ¨æ ‡è®°å·²è¯»
- âœ… ä¸€é”®å…¨éƒ¨å·²è¯»
- âœ… ä¸‹æ‹‰åˆ·æ–°
- âœ… ä¸Šæ‹‰åŠ è½½æ›´å¤š

### 3. æ•°æ®åŒæ­¥
- âœ… å‰ç«¯æ“ä½œè§¦å‘åç«¯æ•°æ®å˜æ›´
- âœ… åç«¯æ•°æ®å˜æ›´åˆ›å»ºé€šçŸ¥
- âœ… å‰ç«¯å®æ—¶è·å–é€šçŸ¥
- âœ… å®Œæ•´çš„æ•°æ®é—­ç¯

## ğŸ” æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šæ¥å•é€šçŸ¥
1. ç”¨æˆ·Aå‘å¸ƒè®¢å•
2. ç”¨æˆ·Bæ¥å•
3. ç”¨æˆ·Aæ”¶åˆ°"è®¢å•å·²è¢«æ¥å•"é€šçŸ¥
4. ç”¨æˆ·Aç‚¹å‡»é€šçŸ¥æŸ¥çœ‹è®¢å•è¯¦æƒ…

### åœºæ™¯2ï¼šå®Œæˆè®¢å•é€šçŸ¥
1. ç”¨æˆ·Bå®Œæˆè®¢å•
2. ç”¨æˆ·Aæ”¶åˆ°"è®¢å•å·²å®Œæˆ"é€šçŸ¥
3. ç”¨æˆ·Aç‚¹å‡»é€šçŸ¥æŸ¥çœ‹è®¢å•è¯¦æƒ…

### åœºæ™¯3ï¼šå–æ¶ˆè®¢å•é€šçŸ¥
1. ç”¨æˆ·Aæˆ–ç”¨æˆ·Bå–æ¶ˆè®¢å•
2. å¦ä¸€æ–¹æ”¶åˆ°"è®¢å•å·²å–æ¶ˆ"é€šçŸ¥
3. ç‚¹å‡»é€šçŸ¥æŸ¥çœ‹è®¢å•è¯¦æƒ…

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### notifications è¡¨
```sql
CREATE TABLE notifications (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,              -- æ¥æ”¶ç”¨æˆ·ID
  order_id INT,                      -- å…³è”è®¢å•ID
  type VARCHAR(50) NOT NULL,         -- é€šçŸ¥ç±»å‹
  title VARCHAR(200) NOT NULL,       -- é€šçŸ¥æ ‡é¢˜
  content TEXT NOT NULL,             -- é€šçŸ¥å†…å®¹
  is_read BOOLEAN DEFAULT FALSE,     -- æ˜¯å¦å·²è¯»
  read_at TIMESTAMP NULL,            -- é˜…è¯»æ—¶é—´
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (order_id) REFERENCES orders(id),
  INDEX idx_user (user_id),
  INDEX idx_is_read (is_read)
);
```

## ğŸ‰ å®Œå–„æ•ˆæœ

### å‰ç«¯æ“ä½œ â†’ åç«¯æ•°æ®å˜æ›´ â†’ é€šçŸ¥æ¨é€

```
ç”¨æˆ·Aå‘å¸ƒè®¢å•
  â†“
è®¢å•å­˜å…¥æ•°æ®åº“
  â†“
ç”¨æˆ·Bæµè§ˆè®¢å•åˆ—è¡¨ï¼ˆä»æ•°æ®åº“è·å–ï¼‰
  â†“
ç”¨æˆ·Bç‚¹å‡»æ¥å•
  â†“
åç«¯æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆæ•°æ®åº“ï¼‰
  â†“
åç«¯åˆ›å»ºé€šçŸ¥ï¼ˆæ•°æ®åº“ï¼‰
  â†“
ç”¨æˆ·Aåˆ·æ–°é¡µé¢
  â†“
æ˜¾ç¤ºæœªè¯»é€šçŸ¥æ•°é‡
  â†“
ç”¨æˆ·Aç‚¹å‡»æŸ¥çœ‹é€šçŸ¥
  â†“
é€šçŸ¥åˆ—è¡¨ä»æ•°æ®åº“è·å–
  â†“
ç”¨æˆ·Aç‚¹å‡»é€šçŸ¥
  â†“
è·³è½¬åˆ°è®¢å•è¯¦æƒ…ï¼ˆä»æ•°æ®åº“è·å–ï¼‰
  â†“
å®Œæ•´çš„æ•°æ®é—­ç¯ï¼
```

## âœ¨ æ ¸å¿ƒä¼˜åŠ¿

1. **å®Œå…¨åŠ¨æ€** - æ‰€æœ‰æ•°æ®æ¥è‡ªæ•°æ®åº“ï¼Œæ— é™æ€æ•°æ®
2. **å®æ—¶åŒæ­¥** - å‰ç«¯æ“ä½œç«‹å³åæ˜ åˆ°åç«¯æ•°æ®
3. **è‡ªåŠ¨é€šçŸ¥** - è®¢å•çŠ¶æ€å˜æ›´è‡ªåŠ¨åˆ›å»ºé€šçŸ¥
4. **ç”¨æˆ·å‹å¥½** - æœªè¯»æç¤ºã€ä¸€é”®å·²è¯»ã€è·³è½¬è¯¦æƒ…
5. **æ€§èƒ½ä¼˜åŒ–** - åˆ†é¡µåŠ è½½ã€æŒ‰éœ€åˆ·æ–°

## ğŸ”§ åç»­ä¼˜åŒ–å»ºè®®

### åŠŸèƒ½æ‰©å±•
- [ ] WebSocketå®æ—¶æ¨é€é€šçŸ¥
- [ ] é€šçŸ¥åˆ†ç±»ï¼ˆè®¢å•ã€ç³»ç»Ÿã€æ´»åŠ¨ï¼‰
- [ ] é€šçŸ¥è®¾ç½®ï¼ˆå¼€å…³ã€å…æ‰“æ‰°ï¼‰
- [ ] é€šçŸ¥æ¨¡æ¿ç®¡ç†
- [ ] æ‰¹é‡æ“ä½œé€šçŸ¥

### æ€§èƒ½ä¼˜åŒ–
- [ ] é€šçŸ¥ç¼“å­˜
- [ ] å®šæ—¶æ¸…ç†å·²è¯»é€šçŸ¥
- [ ] é€šçŸ¥èšåˆï¼ˆç›¸åŒç±»å‹åˆå¹¶ï¼‰
- [ ] æ¨é€ä¼˜åŒ–ï¼ˆé¿å…é¢‘ç¹æ¨é€ï¼‰

### ç”¨æˆ·ä½“éªŒ
- [ ] é€šçŸ¥å£°éŸ³æç¤º
- [ ] é€šçŸ¥éœ‡åŠ¨
- [ ] é€šçŸ¥é¢„è§ˆ
- [ ] é€šçŸ¥æœç´¢
- [ ] é€šçŸ¥ç­›é€‰

## ğŸ“ æ€»ç»“

æœ¬æ¬¡å®Œå–„æ·»åŠ äº†å®Œæ•´çš„é€šçŸ¥ç³»ç»Ÿï¼Œå®ç°äº†ï¼š

1. âœ… å‰ç«¯æ“ä½œè§¦å‘åç«¯æ•°æ®å˜æ›´
2. âœ… åç«¯æ•°æ®å˜æ›´è‡ªåŠ¨åˆ›å»ºé€šçŸ¥
3. âœ… å‰ç«¯å®æ—¶è·å–å’Œæ˜¾ç¤ºé€šçŸ¥
4. âœ… å®Œæ•´çš„é€šçŸ¥ç®¡ç†åŠŸèƒ½
5. âœ… è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

**é¡¹ç›®ç°åœ¨å…·å¤‡äº†å®Œæ•´çš„æ•°æ®é—­ç¯å’Œå®æ—¶é€šçŸ¥åŠŸèƒ½ï¼** ğŸ‰
